<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 How do I implement LMM’s in R? | Workshop 9: Multivariate Analyses in R</title>
  <meta name="description" content="Multivariate Analyses in R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 How do I implement LMM’s in R? | Workshop 9: Multivariate Analyses in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/qcbsRworkshops/" />
  <meta property="og:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />
  <meta property="og:description" content="Multivariate Analyses in R" />
  <meta name="github-repo" content="qcbsRworkshops/workshop09" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 How do I implement LMM’s in R? | Workshop 9: Multivariate Analyses in R" />
  
  <meta name="twitter:description" content="Multivariate Analyses in R" />
  <meta name="twitter:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />

<meta name="author" content="Developed and maintained by the contributors of the QCBS R Workshop Series" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="how-do-lmms-work.html"/>
<link rel="next" href="generalized-linear-mixed-models-glmms.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/qcbs-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/images/csbq_logo_gray_accueil.png"></a></li>
<link rel="icon" type="image/png" href="assets/images/favicon.ico"/>

<li class="divider"></li>
<li class="part"><span><b>QCBS R Workshop Series</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1</b> Code of conduct</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#expected-behaviour"><i class="fa fa-check"></i><b>0.1.1</b> Expected behaviour</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#unacceptable-behaviour"><i class="fa fa-check"></i><b>0.1.2</b> Unacceptable behaviour</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>0.2</b> Contributors</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#contributing"><i class="fa fa-check"></i><b>0.3</b> Contributing</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning objectives</a></li>
<li class="chapter" data-level="2" data-path="preparing-for-the-workshop.html"><a href="preparing-for-the-workshop.html"><i class="fa fa-check"></i><b>2</b> Preparing for the workshop</a></li>
<li class="part"><span><b>Linear mixed models (LMMs)</b></span></li>
<li class="chapter" data-level="3" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>3</b> Overview</a></li>
<li class="chapter" data-level="4" data-path="what-is-a-lmm-and-why-should-i-care.html"><a href="what-is-a-lmm-and-why-should-i-care.html"><i class="fa fa-check"></i><b>4</b> What is a LMM and why should I care?</a></li>
<li class="chapter" data-level="5" data-path="introduction-to-the-dataset.html"><a href="introduction-to-the-dataset.html"><i class="fa fa-check"></i><b>5</b> Introduction to the dataset</a></li>
<li class="chapter" data-level="6" data-path="how-do-i-analyze-this-dataset.html"><a href="how-do-i-analyze-this-dataset.html"><i class="fa fa-check"></i><b>6</b> How do I analyze this dataset?</a><ul>
<li class="chapter" data-level="6.1" data-path="how-do-i-analyze-this-dataset.html"><a href="how-do-i-analyze-this-dataset.html#run-many-separate-analyses"><i class="fa fa-check"></i><b>6.1</b> Run many separate analyses</a></li>
<li class="chapter" data-level="6.2" data-path="how-do-i-analyze-this-dataset.html"><a href="how-do-i-analyze-this-dataset.html#run-one-lumped-analysis"><i class="fa fa-check"></i><b>6.2</b> Run one lumped analysis</a></li>
<li class="chapter" data-level="6.3" data-path="how-do-i-analyze-this-dataset.html"><a href="how-do-i-analyze-this-dataset.html#fit-a-lmm"><i class="fa fa-check"></i><b>6.3</b> Fit a LMM</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="fixed-and-random-effects.html"><a href="fixed-and-random-effects.html"><i class="fa fa-check"></i><b>7</b> Fixed and Random Effects</a><ul>
<li class="chapter" data-level="7.1" data-path="fixed-and-random-effects.html"><a href="fixed-and-random-effects.html#fixed-effect"><i class="fa fa-check"></i><b>7.1</b> Fixed effect</a></li>
<li class="chapter" data-level="7.2" data-path="fixed-and-random-effects.html"><a href="fixed-and-random-effects.html#random-effect"><i class="fa fa-check"></i><b>7.2</b> Random effect</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html"><i class="fa fa-check"></i><b>8</b> How do LMM’s work?</a><ul>
<li class="chapter" data-level="8.1" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#intercepts-andor-slopes-are-allowed-to-vary-by-lake-and-species"><i class="fa fa-check"></i><b>8.1</b> Intercepts and/or slopes are allowed to vary by lake and species</a></li>
<li class="chapter" data-level="8.2" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#intercepts-slopes-and-associated-confidence-intervals-are-adjusted-to-account-for-the-structure-of-data"><i class="fa fa-check"></i><b>8.2</b> Intercepts, slopes, and associated confidence intervals are adjusted to account for the structure of data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="how-do-i-implement-lmms-in-r.html"><a href="how-do-i-implement-lmms-in-r.html"><i class="fa fa-check"></i><b>9</b> How do I implement LMM’s in R?</a><ul>
<li class="chapter" data-level="9.1" data-path="how-do-i-implement-lmms-in-r.html"><a href="how-do-i-implement-lmms-in-r.html#the-mixed-model-protocol-in-r"><i class="fa fa-check"></i><b>9.1</b> The mixed model protocol in R:</a></li>
<li class="chapter" data-level="9.2" data-path="how-do-i-implement-lmms-in-r.html"><a href="how-do-i-implement-lmms-in-r.html#a-priori-model-building-and-data-exploration"><i class="fa fa-check"></i><b>9.2</b> A priori model building and data exploration</a></li>
<li class="chapter" data-level="9.3" data-path="how-do-i-implement-lmms-in-r.html"><a href="how-do-i-implement-lmms-in-r.html#coding-potential-models-and-model-selection"><i class="fa fa-check"></i><b>9.3</b> Coding potential models and model selection</a></li>
<li class="chapter" data-level="9.4" data-path="how-do-i-implement-lmms-in-r.html"><a href="how-do-i-implement-lmms-in-r.html#model-validation"><i class="fa fa-check"></i><b>9.4</b> Model validation</a></li>
<li class="chapter" data-level="9.5" data-path="how-do-i-implement-lmms-in-r.html"><a href="how-do-i-implement-lmms-in-r.html#interpreting-results-and-visualizing-the-model"><i class="fa fa-check"></i><b>9.5</b> Interpreting results and visualizing the model</a></li>
<li class="chapter" data-level="9.6" data-path="how-do-i-implement-lmms-in-r.html"><a href="how-do-i-implement-lmms-in-r.html#thought-experiment"><i class="fa fa-check"></i><b>9.6</b> Thought Experiment</a></li>
</ul></li>
<li class="part"><span><b>Generalized linear mixed models (GLMMs)</b></span></li>
<li class="chapter" data-level="10" data-path="generalized-linear-mixed-models-glmms.html"><a href="generalized-linear-mixed-models-glmms.html"><i class="fa fa-check"></i><b>10</b> Generalized linear mixed models (GLMMs)</a></li>
<li class="chapter" data-level="11" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html"><i class="fa fa-check"></i><b>11</b> Structure in dataset</a><ul>
<li class="chapter" data-level="11.1" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html#poisson-glmm"><i class="fa fa-check"></i><b>11.1</b> Poisson GLMM</a></li>
<li class="chapter" data-level="11.2" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html#negative-binomial-poisson-gamma-glmm"><i class="fa fa-check"></i><b>11.2</b> Negative binomial (Poisson-gamma) GLMM</a></li>
<li class="chapter" data-level="11.3" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html#poisson-lognormal-glmm"><i class="fa fa-check"></i><b>11.3</b> Poisson-lognormal GLMM</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="random-intercepts.html"><a href="random-intercepts.html"><i class="fa fa-check"></i><b>12</b> Random intercepts</a><ul>
<li class="chapter" data-level="12.1" data-path="random-intercepts.html"><a href="random-intercepts.html#parameter-plots"><i class="fa fa-check"></i><b>12.1</b> Parameter plots</a></li>
<li class="chapter" data-level="12.2" data-path="random-intercepts.html"><a href="random-intercepts.html#random-intercept-plots"><i class="fa fa-check"></i><b>12.2</b> Random intercept plots</a></li>
<li class="chapter" data-level="12.3" data-path="random-intercepts.html"><a href="random-intercepts.html#random-slopes"><i class="fa fa-check"></i><b>12.3</b> Random slopes</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="final-model.html"><a href="final-model.html"><i class="fa fa-check"></i><b>13</b> Final model</a></li>
<li class="part"><span><b>Final considerations</b></span></li>
<li class="chapter" data-level="14" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>14</b> Summary</a></li>
<li class="chapter" data-level="15" data-path="additional-resources.html"><a href="additional-resources.html"><i class="fa fa-check"></i><b>15</b> Additional resources</a><ul>
<li class="chapter" data-level="15.1" data-path="additional-resources.html"><a href="additional-resources.html#lmm-textbooks"><i class="fa fa-check"></i><b>15.1</b> LMM Textbooks</a></li>
<li class="chapter" data-level="15.2" data-path="additional-resources.html"><a href="additional-resources.html#glmm-resources"><i class="fa fa-check"></i><b>15.2</b> GLMM resources</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>16</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/qcbsRworkshops" target="blank">QCBS R Workshop Series</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop 9: Multivariate Analyses in <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!------------------------ Hero Image Container --------------------------> 

<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <script src="https://kit.fontawesome.com/6a26f47516.js"></script>
  <script src="assets/qcbs-hideOutput.js"></script>
  <link href="assets/qcbs-style.css" rel="stylesheet">
</head>



<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/images/jean-philippe-delberghe-75xPHEQBmvA-unsplash_hero_image.jpg">
</div>
<div id="how-do-i-implement-lmms-in-r" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> How do I implement LMM’s in R?</h1>
<div id="the-mixed-model-protocol-in-r" class="section level2">
<h2><span class="header-section-number">9.1</span> The mixed model protocol in R:</h2>
<pre><code>2.1: A priori model building and data exploration
2.2: Coding potential models and model selection
2.3: Model validation
2.4: Interpreting results and visualizing the model</code></pre>
</div>
<div id="a-priori-model-building-and-data-exploration" class="section level2">
<h2><span class="header-section-number">9.2</span> A priori model building and data exploration</h2>
<p>We are interested in finding out if trophic position can be predicted by
length, while accounting for variation between species and lakes. So we
know we want a model that looks something like this:</p>
<p>&lt;m&gt; {TP_ijk} ∼ {Length_i} + {Lake_j} + {Species_k} + {ε} &lt;/m&gt;</p>
<p>where,<br />
</p>
<p>&lt;m&gt;{TP_ijk}&lt;/m&gt; is the trophic position of individual (i) from lake
(j) of species (k)<br />
and<br />
ε are the residuals of the model (i.e. the unexplained variation).<br />
</p>
<p><strong>Data Exploration</strong></p>
<p>Always make sure you’ve done "Housekeeping" on your data before you
start building models! Is the data in the right structure? Use the
following code to view the structure and variable types within your data
frame.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="how-do-i-implement-lmms-in-r.html#cb9-1"></a><span class="co">################ Section 2######################### Running a mixed model in</span></span>
<span id="cb9-2"><a href="how-do-i-implement-lmms-in-r.html#cb9-2"></a><span class="co">################ R Four Step Process to build a mixed model in R</span></span>
<span id="cb9-3"><a href="how-do-i-implement-lmms-in-r.html#cb9-3"></a></span>
<span id="cb9-4"><a href="how-do-i-implement-lmms-in-r.html#cb9-4"></a><span class="co"># 1) A priori model bulding and data exploration#### i) Map</span></span>
<span id="cb9-5"><a href="how-do-i-implement-lmms-in-r.html#cb9-5"></a><span class="co"># out the model based on a priori knowledge We know that we</span></span>
<span id="cb9-6"><a href="how-do-i-implement-lmms-in-r.html#cb9-6"></a><span class="co"># want to build a model that evaluates the relationship</span></span>
<span id="cb9-7"><a href="how-do-i-implement-lmms-in-r.html#cb9-7"></a><span class="co"># bewteen trophic position and length while accounting for</span></span>
<span id="cb9-8"><a href="how-do-i-implement-lmms-in-r.html#cb9-8"></a><span class="co"># lake and species variation Trophic Position ~ Length +</span></span>
<span id="cb9-9"><a href="how-do-i-implement-lmms-in-r.html#cb9-9"></a><span class="co"># Species + Lake</span></span>
<span id="cb9-10"><a href="how-do-i-implement-lmms-in-r.html#cb9-10"></a></span>
<span id="cb9-11"><a href="how-do-i-implement-lmms-in-r.html#cb9-11"></a><span class="co"># ii)Housekeeping and data exploration Ensure that the</span></span>
<span id="cb9-12"><a href="how-do-i-implement-lmms-in-r.html#cb9-12"></a><span class="co"># structure of your data is correct</span></span>
<span id="cb9-13"><a href="how-do-i-implement-lmms-in-r.html#cb9-13"></a><span class="kw">str</span>(data)</span></code></pre></div>
<p>++++ Output | <img src="images/fig_13_w5.png" width="600" /> ++++</p>
<p>Look at the distribution of samples across factors:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="how-do-i-implement-lmms-in-r.html#cb10-1"></a><span class="co"># Look at sample distribution across factors to check if</span></span>
<span id="cb10-2"><a href="how-do-i-implement-lmms-in-r.html#cb10-2"></a><span class="co"># there are any major unequal distributions</span></span>
<span id="cb10-3"><a href="how-do-i-implement-lmms-in-r.html#cb10-3"></a><span class="kw">table</span>(data<span class="op">$</span>Lake)</span>
<span id="cb10-4"><a href="how-do-i-implement-lmms-in-r.html#cb10-4"></a><span class="kw">table</span>(data<span class="op">$</span>Fish_Species)</span></code></pre></div>
<p>++++ Output | <strong>Lake</strong><br />
---- <img src="images/fig_15_w5.png" width="200" /><br />
---- <strong>Species</strong><br />
---- <img src="images/fig_14_w5.png" width="100" /><br />
---- ++++</p>
<p>This data set is perfectly balanced, but mixed models can deal with
unbalanced designs (like we so often have to in Ecology!).</p>
<p>Look at the distribution of continuous variables:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="how-do-i-implement-lmms-in-r.html#cb11-1"></a><span class="co"># Look at distribution of continuous variables Transform if</span></span>
<span id="cb11-2"><a href="how-do-i-implement-lmms-in-r.html#cb11-2"></a><span class="co"># necessary (will avoid future problems with homogeneity of</span></span>
<span id="cb11-3"><a href="how-do-i-implement-lmms-in-r.html#cb11-3"></a><span class="co"># model residuals)</span></span>
<span id="cb11-4"><a href="how-do-i-implement-lmms-in-r.html#cb11-4"></a><span class="kw">hist</span>(data<span class="op">$</span>Fish_Length)</span>
<span id="cb11-5"><a href="how-do-i-implement-lmms-in-r.html#cb11-5"></a><span class="kw">hist</span>(data<span class="op">$</span>Trophic_Pos)</span></code></pre></div>
<p>++++ Output | <strong>Length</strong><br />
---- <img src="images/fig_16_w5.png" width="400" /><br />
---- <strong>Trophic Position</strong><br />
---- <img src="images/fig_17_w5.png" width="400" /><br />
---- ++++ Major skews can lead to problems with model homogeneity
down the road. So if necessary, make transformations. In this case, the
data seems OK.</p>
<p>Check for collinearity between variables: It is important not to include
2 collinear variables in the same model, otherwise their effects on the
response variable will be confounded, i.e. the model can’t tell which
of the collinear variable is responsible for the variation in the
response variable. By default, the model would give a lot of explanatory
power to the first variable in the model, and little power to the
following variables.</p>
<p>In this example, we have only one explanatory variable, so there is no
risk of collinearity. If you did have another explanatory variable
(Var2) and wanted to check for collinearity, you could use:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="how-do-i-implement-lmms-in-r.html#cb12-1"></a><span class="co"># Check for collinearity between variables</span></span>
<span id="cb12-2"><a href="how-do-i-implement-lmms-in-r.html#cb12-2"></a><span class="kw">plot</span>(data)</span>
<span id="cb12-3"><a href="how-do-i-implement-lmms-in-r.html#cb12-3"></a><span class="kw">cor</span>(data<span class="op">$</span>Fish_Length, data<span class="op">$</span>Var2)</span></code></pre></div>
<hr />
<p><strong>CHALLENGE 3</strong><br />
</p>
<p>What are some additional measures we could have gotten in the wild that
might have been collinear with length?</p>
<p>++++ Challenge 3 Answer | One example is fish mass - this is highly
correlated with fish length. Therefore, we would not want to include
both in the same model as predictors. ++++</p>
<hr />
<p>Consider the scale of your <a href="data:\" class="uri">data:\</a>
If two variables in the same model have different ranges of scale, the
criteria the mixed models use to come up with parameter estimates are
likely to return ‘convergence errors’. Z-correction standardizes your
variables and adjusts for this scaling problem by placing all your
variables on the same scale even if they were originally in different
units:<br />
&lt;m&gt; {z} = ({x} - {mean(x)}) / {sd(x)} &lt;/m&gt;<br />
Because the data we are dealing with have such variable scales (length
is a longer scale than trophic position), we z-correct it.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="how-do-i-implement-lmms-in-r.html#cb13-1"></a><span class="co"># Consider the scales of your variables Note: when 2</span></span>
<span id="cb13-2"><a href="how-do-i-implement-lmms-in-r.html#cb13-2"></a><span class="co"># variables have very different ranges of scale the criteria</span></span>
<span id="cb13-3"><a href="how-do-i-implement-lmms-in-r.html#cb13-3"></a><span class="co"># mixed models use to come up with parameter estimates are</span></span>
<span id="cb13-4"><a href="how-do-i-implement-lmms-in-r.html#cb13-4"></a><span class="co"># likely to return &#39;convergance errors&#39; Z correcting adjusts</span></span>
<span id="cb13-5"><a href="how-do-i-implement-lmms-in-r.html#cb13-5"></a><span class="co"># for this scaling problem: What is a z correction?: (z = (x</span></span>
<span id="cb13-6"><a href="how-do-i-implement-lmms-in-r.html#cb13-6"></a><span class="co"># - mean(x))/sd(x)) Z-correct Length</span></span>
<span id="cb13-7"><a href="how-do-i-implement-lmms-in-r.html#cb13-7"></a>data<span class="op">$</span>Z_Length &lt;-<span class="st"> </span>(data<span class="op">$</span>Fish_Length <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(data<span class="op">$</span>Fish_Length))<span class="op">/</span><span class="kw">sd</span>(data<span class="op">$</span>Fish_Length)</span>
<span id="cb13-8"><a href="how-do-i-implement-lmms-in-r.html#cb13-8"></a><span class="co"># Z-correct Trophic Position</span></span>
<span id="cb13-9"><a href="how-do-i-implement-lmms-in-r.html#cb13-9"></a>data<span class="op">$</span>Z_TP &lt;-<span class="st"> </span>(data<span class="op">$</span>Trophic_Pos <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(data<span class="op">$</span>Trophic_Pos))<span class="op">/</span><span class="kw">sd</span>(data<span class="op">$</span>Trophic_Pos)</span></code></pre></div>
<p>To know if a mixed model is necessary for your data set you must
establish if it is actually important to account for variation in the
factors that might be affecting the relationship that you’re interested
in, Lake and Species in this case.<br />
We can do this by:</p>
<pre><code>-Creating a linear model without factors
-Calculating the residuals of this linear model
-Ploting the residuals of the linear model against the factors of interest</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="how-do-i-implement-lmms-in-r.html#cb15-1"></a><span class="co"># Find out if it is important to account for variation in</span></span>
<span id="cb15-2"><a href="how-do-i-implement-lmms-in-r.html#cb15-2"></a><span class="co"># &#39;random effects&#39; by comparing the residuals of a linear</span></span>
<span id="cb15-3"><a href="how-do-i-implement-lmms-in-r.html#cb15-3"></a><span class="co"># model without the random effects with the potential random</span></span>
<span id="cb15-4"><a href="how-do-i-implement-lmms-in-r.html#cb15-4"></a><span class="co"># effects</span></span>
<span id="cb15-5"><a href="how-do-i-implement-lmms-in-r.html#cb15-5"></a>lm.test &lt;-<span class="st"> </span><span class="kw">lm</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length, <span class="dt">data =</span> data)</span>
<span id="cb15-6"><a href="how-do-i-implement-lmms-in-r.html#cb15-6"></a>lm.test.resid &lt;-<span class="st"> </span><span class="kw">rstandard</span>(lm.test)</span>
<span id="cb15-7"><a href="how-do-i-implement-lmms-in-r.html#cb15-7"></a><span class="co"># Species Effect</span></span>
<span id="cb15-8"><a href="how-do-i-implement-lmms-in-r.html#cb15-8"></a><span class="kw">plot</span>(lm.test.resid <span class="op">~</span><span class="st"> </span>data<span class="op">$</span>Fish_Species, <span class="dt">xlab =</span> <span class="st">&quot;Species&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Standardized residuals&quot;</span>)</span>
<span id="cb15-9"><a href="how-do-i-implement-lmms-in-r.html#cb15-9"></a><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb15-10"><a href="how-do-i-implement-lmms-in-r.html#cb15-10"></a><span class="co"># Lake Effect</span></span>
<span id="cb15-11"><a href="how-do-i-implement-lmms-in-r.html#cb15-11"></a><span class="kw">plot</span>(lm.test.resid <span class="op">~</span><span class="st"> </span>data<span class="op">$</span>Lake, <span class="dt">xlab =</span> <span class="st">&quot;Lake&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Standardized residuals&quot;</span>)</span>
<span id="cb15-12"><a href="how-do-i-implement-lmms-in-r.html#cb15-12"></a><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>++++ Output| <strong>Species</strong><br />
---- <img src="images/fig_18_w5.png" width="400" /><br />
---- <strong>Lake</strong><br />
---- <img src="images/fig_19_w5.png" width="400" /><br />
---- ++++</p>
<p>For this model, we should keep the random effects because the
standardized residuals show variation across lake and species.</p>
</div>
<div id="coding-potential-models-and-model-selection" class="section level2">
<h2><span class="header-section-number">9.3</span> Coding potential models and model selection</h2>
<p>Our a priori model<br />
&lt;m&gt; {TP_ijk} ∼ {Length_i} + {Lake_j} + {Species_k} + {ε} &lt;/m&gt;<br />
coded in R looks like this:<br />
<img src="images/fig_20_w5.png" width="500" /></p>
<p>The lmer structure is not intuitive. The basic parts to the function
are:<br />
<img src="images/fig_21_w5.png" width="500" /><br />
REML (Restricted Maximum Likelihood) is the default estimation method in
the "lmer" function. REML estimates can be used when comparing models
with the same fixed effects (i.e. nested models). However, if you are
comparing models where the fixed effects differ among models then
maximum likelihood should be used to fit parameters as this method is
not dependent on the coefficients of the fixed effects. Fitting using
maximum likelihood is done by setting REML=FALSE in the lmer command.</p>
<p>What about coding varying slopes as well as intercepts?<br />
<img src="images/fig_22_w5.png" width="500" /><br />
</p>
<hr />
<p><strong>CHALLENGE 4</strong><br />
Re-write the following code so that the slopes of the trophic
position/length relationship also vary by lake and species.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="how-do-i-implement-lmms-in-r.html#cb16-1"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Species), <span class="dt">data =</span> data, </span>
<span id="cb16-2"><a href="how-do-i-implement-lmms-in-r.html#cb16-2"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>++++ Challenge 4 Answer |</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="how-do-i-implement-lmms-in-r.html#cb17-1"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span></span>
<span id="cb17-2"><a href="how-do-i-implement-lmms-in-r.html#cb17-2"></a><span class="st">    </span>Species), <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>++++</p>
<hr />
<p>To determine if you’ve built the best linear mixed model based on your
a priori knowledge you must compare this "a-priori" model to possible
alternative models. With the dataset we are working with there are many
potential models that might best fit the data.</p>
<hr />
<p><strong>CHALLENGE 5</strong><br />
Make a list of 7 alternative models to the following model that can be
built and compared: Note - If we had different fixed effects among
models we would have to indicate "REML=FALSE" to compare with
likelihood methods like AIC (see explanation above). However, you should
report parameter estimates from the ‘best’ model using "REML=TRUE".</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="how-do-i-implement-lmms-in-r.html#cb18-1"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Species), <span class="dt">data =</span> data, </span>
<span id="cb18-2"><a href="how-do-i-implement-lmms-in-r.html#cb18-2"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>++++ Challenge 5 Answer |</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="how-do-i-implement-lmms-in-r.html#cb19-1"></a>m1 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Species), <span class="dt">data =</span> data, </span>
<span id="cb19-2"><a href="how-do-i-implement-lmms-in-r.html#cb19-2"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-3"><a href="how-do-i-implement-lmms-in-r.html#cb19-3"></a>m2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span></span>
<span id="cb19-4"><a href="how-do-i-implement-lmms-in-r.html#cb19-4"></a><span class="st">    </span>Species), <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-5"><a href="how-do-i-implement-lmms-in-r.html#cb19-5"></a>m3 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Species), <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-6"><a href="how-do-i-implement-lmms-in-r.html#cb19-6"></a>m4 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-7"><a href="how-do-i-implement-lmms-in-r.html#cb19-7"></a>m5 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Species), <span class="dt">data =</span> data, </span>
<span id="cb19-8"><a href="how-do-i-implement-lmms-in-r.html#cb19-8"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-9"><a href="how-do-i-implement-lmms-in-r.html#cb19-9"></a>m6 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> data, </span>
<span id="cb19-10"><a href="how-do-i-implement-lmms-in-r.html#cb19-10"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-11"><a href="how-do-i-implement-lmms-in-r.html#cb19-11"></a>m7 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Species), </span>
<span id="cb19-12"><a href="how-do-i-implement-lmms-in-r.html#cb19-12"></a>    <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-13"><a href="how-do-i-implement-lmms-in-r.html#cb19-13"></a>m8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Species), </span>
<span id="cb19-14"><a href="how-do-i-implement-lmms-in-r.html#cb19-14"></a>    <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-15"><a href="how-do-i-implement-lmms-in-r.html#cb19-15"></a></span>
<span id="cb19-16"><a href="how-do-i-implement-lmms-in-r.html#cb19-16"></a><span class="co"># Bonus model!</span></span>
<span id="cb19-17"><a href="how-do-i-implement-lmms-in-r.html#cb19-17"></a>M0 &lt;-<span class="st"> </span><span class="kw">lm</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length, <span class="dt">data =</span> data)</span>
<span id="cb19-18"><a href="how-do-i-implement-lmms-in-r.html#cb19-18"></a><span class="co"># It is always useful to build the simple linear model</span></span>
<span id="cb19-19"><a href="how-do-i-implement-lmms-in-r.html#cb19-19"></a><span class="co"># without any varying intercept and slope factors to see the</span></span>
<span id="cb19-20"><a href="how-do-i-implement-lmms-in-r.html#cb19-20"></a><span class="co"># difference in AICc values. Although &#39;lm&#39; does not use the</span></span>
<span id="cb19-21"><a href="how-do-i-implement-lmms-in-r.html#cb19-21"></a><span class="co"># same estimation method</span></span></code></pre></div>
<p>++++</p>
<hr />
<p>Now that we have a list of potential models, we can compare them to get
a better idea of what is going on in our dataset and to select the
one(s) with the highest predictive power given the data. Models can be
compared using the "AICc" function from the "AICcmodavg" package.
The Akaike Information Criterion (AIC) is a measure of model quality
that can be used to compare models. AICc corrects for bias created by
small sample size when estimating AIC.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="how-do-i-implement-lmms-in-r.html#cb20-1"></a><span class="co"># 2) Coding potential models and model selection#### i)</span></span>
<span id="cb20-2"><a href="how-do-i-implement-lmms-in-r.html#cb20-2"></a><span class="co"># Coding all potential models List of all Potential models--&gt;</span></span>
<span id="cb20-3"><a href="how-do-i-implement-lmms-in-r.html#cb20-3"></a><span class="co"># Note: you can chose to not code ones that do not make</span></span>
<span id="cb20-4"><a href="how-do-i-implement-lmms-in-r.html#cb20-4"></a><span class="co"># biological sense.  Linear model with no random effects</span></span>
<span id="cb20-5"><a href="how-do-i-implement-lmms-in-r.html#cb20-5"></a>M0 &lt;-<span class="st"> </span><span class="kw">lm</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length, <span class="dt">data =</span> data)</span>
<span id="cb20-6"><a href="how-do-i-implement-lmms-in-r.html#cb20-6"></a><span class="co"># Full model with varying intercepts</span></span>
<span id="cb20-7"><a href="how-do-i-implement-lmms-in-r.html#cb20-7"></a>M1 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), </span>
<span id="cb20-8"><a href="how-do-i-implement-lmms-in-r.html#cb20-8"></a>    <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb20-9"><a href="how-do-i-implement-lmms-in-r.html#cb20-9"></a><span class="co"># Full model with varying intercepts and slopes</span></span>
<span id="cb20-10"><a href="how-do-i-implement-lmms-in-r.html#cb20-10"></a>M2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-11"><a href="how-do-i-implement-lmms-in-r.html#cb20-11"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb20-12"><a href="how-do-i-implement-lmms-in-r.html#cb20-12"></a><span class="co"># No Lake, varying intercepts only</span></span>
<span id="cb20-13"><a href="how-do-i-implement-lmms-in-r.html#cb20-13"></a>M3 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> data, </span>
<span id="cb20-14"><a href="how-do-i-implement-lmms-in-r.html#cb20-14"></a>    <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb20-15"><a href="how-do-i-implement-lmms-in-r.html#cb20-15"></a><span class="co"># No Species, varying intercepts only</span></span>
<span id="cb20-16"><a href="how-do-i-implement-lmms-in-r.html#cb20-16"></a>M4 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb20-17"><a href="how-do-i-implement-lmms-in-r.html#cb20-17"></a><span class="co"># No Lake, varying intercepts and slopes</span></span>
<span id="cb20-18"><a href="how-do-i-implement-lmms-in-r.html#cb20-18"></a>M5 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> data, </span>
<span id="cb20-19"><a href="how-do-i-implement-lmms-in-r.html#cb20-19"></a>    <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb20-20"><a href="how-do-i-implement-lmms-in-r.html#cb20-20"></a><span class="co"># No Species, varying intercepts and slopes</span></span>
<span id="cb20-21"><a href="how-do-i-implement-lmms-in-r.html#cb20-21"></a>M6 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> data, </span>
<span id="cb20-22"><a href="how-do-i-implement-lmms-in-r.html#cb20-22"></a>    <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb20-23"><a href="how-do-i-implement-lmms-in-r.html#cb20-23"></a><span class="co"># Full model with varying intercepts and slopes only varying</span></span>
<span id="cb20-24"><a href="how-do-i-implement-lmms-in-r.html#cb20-24"></a><span class="co"># by lake</span></span>
<span id="cb20-25"><a href="how-do-i-implement-lmms-in-r.html#cb20-25"></a>M7 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span></span>
<span id="cb20-26"><a href="how-do-i-implement-lmms-in-r.html#cb20-26"></a><span class="st">    </span>Lake), <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb20-27"><a href="how-do-i-implement-lmms-in-r.html#cb20-27"></a><span class="co"># Full model with varying intercepts and slopes only varying</span></span>
<span id="cb20-28"><a href="how-do-i-implement-lmms-in-r.html#cb20-28"></a><span class="co"># by species</span></span>
<span id="cb20-29"><a href="how-do-i-implement-lmms-in-r.html#cb20-29"></a>M8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-30"><a href="how-do-i-implement-lmms-in-r.html#cb20-30"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb20-31"><a href="how-do-i-implement-lmms-in-r.html#cb20-31"></a></span>
<span id="cb20-32"><a href="how-do-i-implement-lmms-in-r.html#cb20-32"></a></span>
<span id="cb20-33"><a href="how-do-i-implement-lmms-in-r.html#cb20-33"></a><span class="co"># ii) Compare models using AICc values Compute AICc values</span></span>
<span id="cb20-34"><a href="how-do-i-implement-lmms-in-r.html#cb20-34"></a><span class="co"># for each model</span></span>
<span id="cb20-35"><a href="how-do-i-implement-lmms-in-r.html#cb20-35"></a>AICc &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">AICc</span>(M0), <span class="kw">AICc</span>(M1), <span class="kw">AICc</span>(M2), <span class="kw">AICc</span>(M3), <span class="kw">AICc</span>(M4), <span class="kw">AICc</span>(M5), </span>
<span id="cb20-36"><a href="how-do-i-implement-lmms-in-r.html#cb20-36"></a>    <span class="kw">AICc</span>(M6), <span class="kw">AICc</span>(M7), <span class="kw">AICc</span>(M8))</span>
<span id="cb20-37"><a href="how-do-i-implement-lmms-in-r.html#cb20-37"></a><span class="co"># Put values into one table for easy comparision</span></span>
<span id="cb20-38"><a href="how-do-i-implement-lmms-in-r.html#cb20-38"></a>Model &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;M0&quot;</span>, <span class="st">&quot;M1&quot;</span>, <span class="st">&quot;M2&quot;</span>, <span class="st">&quot;M3&quot;</span>, <span class="st">&quot;M4&quot;</span>, <span class="st">&quot;M5&quot;</span>, <span class="st">&quot;M6&quot;</span>, <span class="st">&quot;M7&quot;</span>, <span class="st">&quot;M8&quot;</span>)</span>
<span id="cb20-39"><a href="how-do-i-implement-lmms-in-r.html#cb20-39"></a>AICtable &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Model =</span> Model, <span class="dt">AICc =</span> AICc)</span>
<span id="cb20-40"><a href="how-do-i-implement-lmms-in-r.html#cb20-40"></a>AICtable</span>
<span id="cb20-41"><a href="how-do-i-implement-lmms-in-r.html#cb20-41"></a><span class="co"># M8 has the lowest AICc value so it is the best fit model M2</span></span>
<span id="cb20-42"><a href="how-do-i-implement-lmms-in-r.html#cb20-42"></a><span class="co"># is also a good fit, but all other models are not nearly as</span></span>
<span id="cb20-43"><a href="how-do-i-implement-lmms-in-r.html#cb20-43"></a><span class="co"># good.  Note when you compare models they must be fit by</span></span>
<span id="cb20-44"><a href="how-do-i-implement-lmms-in-r.html#cb20-44"></a><span class="co"># Maximum Likelihood (ML) and not by Restricted Maximum</span></span>
<span id="cb20-45"><a href="how-do-i-implement-lmms-in-r.html#cb20-45"></a><span class="co"># Likelihood (REML)</span></span></code></pre></div>
<p>++++ Output| <img src="images/fig_23_w5.png" width="200" /> ++++</p>
<p>The model with the lowest AIC value has the most predictive power given
the data. Some suggest that if models are within 2 AICc units of each
other then they are equally plausible. In this case, we can take a
closer look at M8 and M2, but all other models have such high AICc
values that they are not explaining as much variation in the data as M8
and should not be considered as plausible options to explain the
patterns in the data</p>
<hr />
<p><strong>CHALLENGE 6</strong><br />
Take 2 minutes with your neighbour to draw out the model structure of
M2. Biologically, how does it differ from M8? Why is it not surprising
that it’s AICc value was 2nd best?</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="how-do-i-implement-lmms-in-r.html#cb21-1"></a>M2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb21-2"><a href="how-do-i-implement-lmms-in-r.html#cb21-2"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>++++ Challenge 6 Answer | M2: The trophic position is a function of
length and both the intercept and the effect of length on trophic
position can vary by fish species and lake.</p>
<p>M8: The trophic position is a function of length and both the intercept
and the effect of length on trophic position can vary by fish species
but only the intercept can vary by lake (not the slope of trophic
position on length).</p>
<p>Biologically, speaking M2 says that intrinsic factors of species (e.g.
growth rates) and lakes (e.g. productivity, community composition, etc.)
cause the relationship between trophic position and length to differ
(i.e. both slopes and intercepts), whereas, M8 says that intrinsic
factors of species alone cause this relationship to differ (i.e. slopes)
and that on average trophic positions might be higher or lower in one
lake versus another (i.e. intercepts).</p>
<p>These models are very similar in structure and the AIC units suggest
this. The added complexity of allowing varying slopes by lake in M2 does
not improve the model’s predictive power when compared to M8. ++++</p>
<hr />
</div>
<div id="model-validation" class="section level2">
<h2><span class="header-section-number">9.4</span> Model validation</h2>
<p>To look at independence plot model fitted values vs residuals values:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="how-do-i-implement-lmms-in-r.html#cb22-1"></a><span class="co"># 3) Checking model assumptions#### Checking for M8 A. Look</span></span>
<span id="cb22-2"><a href="how-do-i-implement-lmms-in-r.html#cb22-2"></a><span class="co"># at independence: plot fitted values vs residuals</span></span>
<span id="cb22-3"><a href="how-do-i-implement-lmms-in-r.html#cb22-3"></a>E1 &lt;-<span class="st"> </span><span class="kw">resid</span>(M8)</span>
<span id="cb22-4"><a href="how-do-i-implement-lmms-in-r.html#cb22-4"></a>F1 &lt;-<span class="st"> </span><span class="kw">fitted</span>(M8)</span>
<span id="cb22-5"><a href="how-do-i-implement-lmms-in-r.html#cb22-5"></a><span class="kw">plot</span>(<span class="dt">x =</span> F1, <span class="dt">y =</span> E1, <span class="dt">xlab =</span> <span class="st">&quot;Fitted Values&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Normalized residuals&quot;</span>)</span>
<span id="cb22-6"><a href="how-do-i-implement-lmms-in-r.html#cb22-6"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>++++ Output| <img src="images/fig_24_w5.png" width="400" /> ++++</p>
<p>The even spread of the residuals suggest that the model is a good fit
for the data.</p>
<p>To check the assumption of homogeneity plot residuals vs each covariate
in the model:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="how-do-i-implement-lmms-in-r.html#cb23-1"></a><span class="co"># B. Look at independence: i. plot residuals vs each</span></span>
<span id="cb23-2"><a href="how-do-i-implement-lmms-in-r.html#cb23-2"></a><span class="co"># covariate in the model Fish_Length</span></span>
<span id="cb23-3"><a href="how-do-i-implement-lmms-in-r.html#cb23-3"></a><span class="kw">plot</span>(<span class="dt">x =</span> data<span class="op">$</span>Z_Length, <span class="dt">y =</span> E1, <span class="dt">xlab =</span> <span class="st">&quot;Z Length&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Normalized residuals&quot;</span>)</span>
<span id="cb23-4"><a href="how-do-i-implement-lmms-in-r.html#cb23-4"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb23-5"><a href="how-do-i-implement-lmms-in-r.html#cb23-5"></a><span class="co"># Note: observed groupings are created by the nature of the</span></span>
<span id="cb23-6"><a href="how-do-i-implement-lmms-in-r.html#cb23-6"></a><span class="co"># data because in the data set we only measured individuals</span></span>
<span id="cb23-7"><a href="how-do-i-implement-lmms-in-r.html#cb23-7"></a><span class="co"># from 5 categories of lengths (big, small, and three groups</span></span>
<span id="cb23-8"><a href="how-do-i-implement-lmms-in-r.html#cb23-8"></a><span class="co"># in between) Species</span></span>
<span id="cb23-9"><a href="how-do-i-implement-lmms-in-r.html#cb23-9"></a><span class="kw">boxplot</span>(E1 <span class="op">~</span><span class="st"> </span>Fish_Species, <span class="dt">ylab =</span> <span class="st">&quot;Normalized residuals&quot;</span>, <span class="dt">data =</span> data, </span>
<span id="cb23-10"><a href="how-do-i-implement-lmms-in-r.html#cb23-10"></a>    <span class="dt">xlab =</span> <span class="st">&quot;Species&quot;</span>)</span>
<span id="cb23-11"><a href="how-do-i-implement-lmms-in-r.html#cb23-11"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb23-12"><a href="how-do-i-implement-lmms-in-r.html#cb23-12"></a><span class="co"># Lake</span></span>
<span id="cb23-13"><a href="how-do-i-implement-lmms-in-r.html#cb23-13"></a><span class="kw">boxplot</span>(E1 <span class="op">~</span><span class="st"> </span>Lake, <span class="dt">ylab =</span> <span class="st">&quot;Normalized residuals&quot;</span>, <span class="dt">data =</span> data, </span>
<span id="cb23-14"><a href="how-do-i-implement-lmms-in-r.html#cb23-14"></a>    <span class="dt">xlab =</span> <span class="st">&quot;Lake&quot;</span>)</span>
<span id="cb23-15"><a href="how-do-i-implement-lmms-in-r.html#cb23-15"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>++++ Output|</p>
<hr />
<p><img src="images/fig_25_w5.png" width="400" /></p>
<hr />
<p><img src="images/fig_26_w5.png" width="400" /></p>
<hr />
<p><img src="images/fig_27_w5.png" width="400" /></p>
<hr />
<p>++++ The equal spread above and below zero indicate that there are no
homogeneity problems with these variables.</p>
<p>Ideally you would also do the above analysis with every covariate not in
your model as well. If you observe patterns in these plots you will know
that there is variation in your dataset that could be accounted for by
these covariates that were not included in the model, and so you should
re-consider the inclusion of this variable in your model. However,
because there are no covariates we measured that we decided not to
include in the model this point is not applicable to this analysis.</p>
<p>It is also important to check the distribution of residual error.
Normally distributed residuals indicate that your model predictions are
not biased high or low:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="how-do-i-implement-lmms-in-r.html#cb24-1"></a><span class="co"># D. Look at normality: histogram</span></span>
<span id="cb24-2"><a href="how-do-i-implement-lmms-in-r.html#cb24-2"></a><span class="kw">hist</span>(E1)</span></code></pre></div>
<p>++++ Output| <img src="images/fig_28_w5.png" width="400" /> ++++</p>
</div>
<div id="interpreting-results-and-visualizing-the-model" class="section level2">
<h2><span class="header-section-number">9.5</span> Interpreting results and visualizing the model</h2>
<p>You can view the model summary using:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="how-do-i-implement-lmms-in-r.html#cb25-1"></a><span class="co"># Look at model summary This allows you to get an idea of the</span></span>
<span id="cb25-2"><a href="how-do-i-implement-lmms-in-r.html#cb25-2"></a><span class="co"># variance explained by the different components of the model</span></span>
<span id="cb25-3"><a href="how-do-i-implement-lmms-in-r.html#cb25-3"></a><span class="co"># and the &#39;significance&#39; of fixed effects</span></span>
<span id="cb25-4"><a href="how-do-i-implement-lmms-in-r.html#cb25-4"></a><span class="kw">summary</span>(M8)</span></code></pre></div>
<p>++++ Output| <img src="images/fig_29_w5.png" width="500" /> ++++ The output is broken
up into descriptions of the Random effects (things we allow to vary
based on the normal distribution) and Fixed effects (things we estimate
in the same way as classical regression):</p>
<p><img src="images/fig_30_w5.png" width="500" /></p>
<p><img src="images/fig_31_w5.png" width="500" /></p>
<p>To determine if the slope and, therefore, the effect of length on
trophic position is significantly different from zero you first have to
calculate the confidence interval (CI) for the slope parameter (estimate
for Z_Length in the fixed effects section = 0.4223). The CI = Standard
Error of the estimate x 1.96 plus or minus the parameter estimate. If
the CI overlaps with zero, then the slope is not significantly different
from zero at the 0.05 level.</p>
<p><img src="images/fig_32_w5.png" width="500" /></p>
<hr />
<p><strong>CHALLENGE 7</strong><br />
a) What is the slope and confidence interval of the Z_Length variable
in the M8 model?</p>
<p>b) Is the Z_Length slope significantly different from 0?</p>
<p>++++ Challenge 7 Answer | a) What is the slope and confidence interval
of the Z_Length variable in the M8 model?</p>
<pre><code>-Slope = 0.4223
 

   upper CI = 0.4223 + 0.09*1.96 = 0.5987
   lower CI = 0.4223 - 0.09*1.96 = 0.2459</code></pre>
<p>b) Is the Z_Length slope significantly different from 0?</p>
<pre><code>-Yes, because the CI does not overlap with 0</code></pre>
<p>++++</p>
<hr />
<p>To visualize this model you must obtain the coefficients (intercept and
slope) of each component of the model. Overall our group level model
coefficients (aka: "coefs", in this case is just one intercept and
slope) can be found in the summary of the model in the fixed effects
section. Coefs for each of the model levels (in this case: Lake and
Species) that were fit from a normal distribution can be obtained using
the "coef()" function.</p>
<p>Two ways to visualize this data is:</p>
<pre><code>-To show the group level model 
-To show species and lake level models</code></pre>
<p>1. To show the group level model:<br />
Obtain the parameters of interest<br />
<img src="images/fig_33_w5.png" width="600" /></p>
<p>and plot the data with the model overlayed</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="how-do-i-implement-lmms-in-r.html#cb29-1"></a><span class="co"># Visualizing model results#### There are several ways of</span></span>
<span id="cb29-2"><a href="how-do-i-implement-lmms-in-r.html#cb29-2"></a><span class="co"># visualizing the results of a mixed model, all of which</span></span>
<span id="cb29-3"><a href="how-do-i-implement-lmms-in-r.html#cb29-3"></a><span class="co"># involve using the coefficients generated by the model.  So</span></span>
<span id="cb29-4"><a href="how-do-i-implement-lmms-in-r.html#cb29-4"></a><span class="co"># the first step is to obtain the model coefficients to be</span></span>
<span id="cb29-5"><a href="how-do-i-implement-lmms-in-r.html#cb29-5"></a><span class="co"># able to add them to the figures</span></span>
<span id="cb29-6"><a href="how-do-i-implement-lmms-in-r.html#cb29-6"></a><span class="kw">coef</span>(M8)</span>
<span id="cb29-7"><a href="how-do-i-implement-lmms-in-r.html#cb29-7"></a><span class="co"># Now put the coefs into dataframes to make them more easy to</span></span>
<span id="cb29-8"><a href="how-do-i-implement-lmms-in-r.html#cb29-8"></a><span class="co"># manipulate</span></span>
<span id="cb29-9"><a href="how-do-i-implement-lmms-in-r.html#cb29-9"></a>Lake.coef &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">coef</span>(M8)<span class="op">$</span>Lake)</span>
<span id="cb29-10"><a href="how-do-i-implement-lmms-in-r.html#cb29-10"></a><span class="kw">colnames</span>(Lake.coef) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Slope&quot;</span>)</span>
<span id="cb29-11"><a href="how-do-i-implement-lmms-in-r.html#cb29-11"></a>Species.coef &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">coef</span>(M8)<span class="op">$</span>Fish_Species)</span>
<span id="cb29-12"><a href="how-do-i-implement-lmms-in-r.html#cb29-12"></a><span class="kw">colnames</span>(Species.coef) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Slope&quot;</span>)</span>
<span id="cb29-13"><a href="how-do-i-implement-lmms-in-r.html#cb29-13"></a></span>
<span id="cb29-14"><a href="how-do-i-implement-lmms-in-r.html#cb29-14"></a><span class="co"># Plot 1 - All Data Make a plot that includes all the data</span></span>
<span id="cb29-15"><a href="how-do-i-implement-lmms-in-r.html#cb29-15"></a>plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Z_Length, Z_TP), <span class="dt">data =</span> data)</span>
<span id="cb29-16"><a href="how-do-i-implement-lmms-in-r.html#cb29-16"></a>Plot_AllData &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Length (mm)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Trophic Position&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb29-17"><a href="how-do-i-implement-lmms-in-r.html#cb29-17"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;All Data&quot;</span>) <span class="op">+</span><span class="st"> </span>fig</span>
<span id="cb29-18"><a href="how-do-i-implement-lmms-in-r.html#cb29-18"></a><span class="co"># Add a layer that has an abline with the intercept and slope</span></span>
<span id="cb29-19"><a href="how-do-i-implement-lmms-in-r.html#cb29-19"></a><span class="co"># of the relationship between length and trophic position.</span></span>
<span id="cb29-20"><a href="how-do-i-implement-lmms-in-r.html#cb29-20"></a><span class="co"># Note that you can obtain the intercept and slope of the</span></span>
<span id="cb29-21"><a href="how-do-i-implement-lmms-in-r.html#cb29-21"></a><span class="co"># fixed factor directly from the model summary</span></span>
<span id="cb29-22"><a href="how-do-i-implement-lmms-in-r.html#cb29-22"></a><span class="kw">summary</span>(M8)</span>
<span id="cb29-23"><a href="how-do-i-implement-lmms-in-r.html#cb29-23"></a>Plot_AllData <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="fl">-0.0009059</span>, <span class="dt">slope =</span> <span class="fl">0.4222697</span>)</span></code></pre></div>
<p>++++ Output| <img src="images/fig_34_w5.png" width="500" /> ++++</p>
<p>2. To show species and lake level models:<br />
Obtain the parameters of interest<br />
<img src="images/fig_35_w5.png" width="200" /></p>
<p>and plot the data with the model overlay:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="how-do-i-implement-lmms-in-r.html#cb30-1"></a><span class="co"># Plot 2 - By Species Plot the data color coded by Species</span></span>
<span id="cb30-2"><a href="how-do-i-implement-lmms-in-r.html#cb30-2"></a>Plot_BySpecies &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="kw">factor</span>(Fish_Species)), </span>
<span id="cb30-3"><a href="how-do-i-implement-lmms-in-r.html#cb30-3"></a>    <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Length (mm)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Trophic Position&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-4"><a href="how-do-i-implement-lmms-in-r.html#cb30-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;By Species&quot;</span>) <span class="op">+</span><span class="st"> </span>fig</span>
<span id="cb30-5"><a href="how-do-i-implement-lmms-in-r.html#cb30-5"></a><span class="co"># Add the regression line with the intercepts and slopes</span></span>
<span id="cb30-6"><a href="how-do-i-implement-lmms-in-r.html#cb30-6"></a><span class="co"># specific to each species</span></span>
<span id="cb30-7"><a href="how-do-i-implement-lmms-in-r.html#cb30-7"></a>Plot_BySpecies <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Species.coef[<span class="dv">1</span>, <span class="dv">1</span>], </span>
<span id="cb30-8"><a href="how-do-i-implement-lmms-in-r.html#cb30-8"></a>    <span class="dt">slope =</span> Species.coef[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dt">colour =</span> <span class="st">&quot;coral2&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Species.coef[<span class="dv">2</span>, </span>
<span id="cb30-9"><a href="how-do-i-implement-lmms-in-r.html#cb30-9"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Species.coef[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">colour =</span> <span class="st">&quot;green4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Species.coef[<span class="dv">3</span>, </span>
<span id="cb30-10"><a href="how-do-i-implement-lmms-in-r.html#cb30-10"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Species.coef[<span class="dv">3</span>, <span class="dv">2</span>], <span class="dt">colour =</span> <span class="st">&quot;blue1&quot;</span>)</span>
<span id="cb30-11"><a href="how-do-i-implement-lmms-in-r.html#cb30-11"></a></span>
<span id="cb30-12"><a href="how-do-i-implement-lmms-in-r.html#cb30-12"></a><span class="co"># Plot 3 - By Lake Plot the data color coded by lake</span></span>
<span id="cb30-13"><a href="how-do-i-implement-lmms-in-r.html#cb30-13"></a>Plot_ByLake &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="kw">factor</span>(Lake)), </span>
<span id="cb30-14"><a href="how-do-i-implement-lmms-in-r.html#cb30-14"></a>    <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Length (mm)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Trophic Position&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-15"><a href="how-do-i-implement-lmms-in-r.html#cb30-15"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;By Lake&quot;</span>) <span class="op">+</span><span class="st"> </span>fig</span>
<span id="cb30-16"><a href="how-do-i-implement-lmms-in-r.html#cb30-16"></a><span class="co"># Add in regression lines with the intercepts specific to</span></span>
<span id="cb30-17"><a href="how-do-i-implement-lmms-in-r.html#cb30-17"></a><span class="co"># each lake</span></span>
<span id="cb30-18"><a href="how-do-i-implement-lmms-in-r.html#cb30-18"></a>Plot_ByLake <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">1</span>, </span>
<span id="cb30-19"><a href="how-do-i-implement-lmms-in-r.html#cb30-19"></a>    <span class="dv">2</span>], <span class="dt">colour =</span> <span class="st">&quot;coral2&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">2</span>, </span>
<span id="cb30-20"><a href="how-do-i-implement-lmms-in-r.html#cb30-20"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">colour =</span> <span class="st">&quot;khaki4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">3</span>, </span>
<span id="cb30-21"><a href="how-do-i-implement-lmms-in-r.html#cb30-21"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">3</span>, <span class="dv">2</span>], <span class="dt">colour =</span> <span class="st">&quot;green4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">4</span>, </span>
<span id="cb30-22"><a href="how-do-i-implement-lmms-in-r.html#cb30-22"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">4</span>, <span class="dv">2</span>], <span class="dt">colour =</span> <span class="st">&quot;darkgoldenrod&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-23"><a href="how-do-i-implement-lmms-in-r.html#cb30-23"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">5</span>, <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">5</span>, </span>
<span id="cb30-24"><a href="how-do-i-implement-lmms-in-r.html#cb30-24"></a>        <span class="dv">2</span>], <span class="dt">colour =</span> <span class="st">&quot;royalblue1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">6</span>, </span>
<span id="cb30-25"><a href="how-do-i-implement-lmms-in-r.html#cb30-25"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">6</span>, <span class="dv">2</span>], <span class="dt">colour =</span> <span class="st">&quot;magenta3&quot;</span>)</span></code></pre></div>
<p>++++ Output| <img src="images/fig_36_w5.png" width="500" />
<img src="images/fig_37_w5.png" width="500" /> ++++</p>
</div>
<div id="thought-experiment" class="section level2">
<h2><span class="header-section-number">9.6</span> Thought Experiment</h2>
<p>Mixed models are really good at accounting for variation in ecological
data while not loosing too many degrees of freedom.</p>
<p>We covered only a small amount of what LMM’s can do. Provided below are
a couple other thought experiments with data structure similar to the
workshop data and two textbooks that fully detail the utility of LMM’s.</p>
<hr />
<p><strong>CHALLENGE 8</strong><br />
Situation: You collected biodiversity estimates from 1000 quadrats that
are within 10 different sites which are within 10 different forests. You
measured the productivity in each quadrat as well. You are mainly
interested in knowing if productivity is a good predictor of
biodiversity.</p>
<p>What mixed model could you use for this dataset? ++++ Challenge 8 Answer
|</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="how-do-i-implement-lmms-in-r.html#cb31-1"></a><span class="op">&gt;</span><span class="kw">lmer</span>(Bio_Div <span class="op">~</span><span class="st"> </span>Productivity <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>Forest<span class="op">/</span>Site))</span>
<span id="cb31-2"><a href="how-do-i-implement-lmms-in-r.html#cb31-2"></a><span class="op">&gt;</span><span class="co">#Here the random effects are nested (i.e. Sites within forests), and not crossed.</span></span></code></pre></div>
<p>++++</p>
<hr />
<hr />
<p><strong>CHALLENGE 9</strong><br />
Situation: You collected 200 fish from 12 different sites evenly
distributed across 4 habitat types found within 1 lake. You measured the
length of each fish and the quantity of mercury in its tissue. You are
mainly interested in knowing if habitat is a good predictor of mercury
concentration.</p>
<p>What mixed model could you use for this data set? ++++ Challenge 9
Answer |</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="how-do-i-implement-lmms-in-r.html#cb32-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">lmer</span>(Mercury<span class="op">~</span>Length<span class="op">*</span>Habitat_Type<span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>Site)...)</span></code></pre></div>
<p>++++</p>

</div>
</div>



<hr>
<center> 
  <div class="footer">
      All the content of the workshop series is under a <a href="https://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="how-do-lmms-work.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="generalized-linear-mixed-models-glmms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
