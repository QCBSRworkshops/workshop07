<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Step 2. Code potential models and model selection | Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)</title>
  <meta name="description" content="Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Step 2. Code potential models and model selection | Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/qcbsRworkshops/" />
  <meta property="og:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />
  <meta property="og:description" content="Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta name="github-repo" content="qcbsRworkshops/workshop09" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Step 2. Code potential models and model selection | Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)" />
  
  <meta name="twitter:description" content="Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta name="twitter:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />

<meta name="author" content="Developed and maintained by the contributors of the QCBS R Workshop Series" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="step-1-a-priori-model-building.html"/>
<link rel="next" href="step-3-model-validation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/qcbs-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/images/csbq_logo_gray_accueil.png"></a></li>
<link rel="icon" type="image/png" href="assets/images/favicon.ico"/>

<li class="divider"></li>
<li class="part"><span><b>QCBS R Workshop Series</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1</b> Code of conduct</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#expected-behaviour"><i class="fa fa-check"></i><b>0.1.1</b> Expected behaviour</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#unacceptable-behaviour"><i class="fa fa-check"></i><b>0.1.2</b> Unacceptable behaviour</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>0.2</b> Contributors</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#contributing"><i class="fa fa-check"></i><b>0.3</b> Contributing</a></li>
</ul></li>
<li class="part"><span><b>Linear mixed models (LMM) in <code>R</code></b></span></li>
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning objectives</a></li>
<li class="chapter" data-level="2" data-path="preparing-for-the-workshop.html"><a href="preparing-for-the-workshop.html"><i class="fa fa-check"></i><b>2</b> Preparing for the workshop</a></li>
<li class="chapter" data-level="3" data-path="why-choose-mixed-models.html"><a href="why-choose-mixed-models.html"><i class="fa fa-check"></i><b>3</b> Why choose mixed models?</a></li>
<li class="chapter" data-level="4" data-path="starting-with-a-question.html"><a href="starting-with-a-question.html"><i class="fa fa-check"></i><b>4</b> Starting with a question</a><ul>
<li class="chapter" data-level="4.1" data-path="starting-with-a-question.html"><a href="starting-with-a-question.html#challenge-1"><i class="fa fa-check"></i><b>4.1</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html"><i class="fa fa-check"></i><b>5</b> Analyzing the data</a><ul>
<li class="chapter" data-level="5.1" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html#separate"><i class="fa fa-check"></i><b>5.1</b> Separate</a></li>
<li class="chapter" data-level="5.2" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html#lump"><i class="fa fa-check"></i><b>5.2</b> Lump</a></li>
<li class="chapter" data-level="5.3" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html#is-there-a-third-option"><i class="fa fa-check"></i><b>5.3</b> Is there a third option?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="fixed-vs-random-effects.html"><a href="fixed-vs-random-effects.html"><i class="fa fa-check"></i><b>6</b> Fixed vs. random effects</a><ul>
<li class="chapter" data-level="6.1" data-path="fixed-vs-random-effects.html"><a href="fixed-vs-random-effects.html#fixed-effects-deterministic-processes"><i class="fa fa-check"></i><b>6.1</b> Fixed effects: deterministic processes</a></li>
<li class="chapter" data-level="6.2" data-path="fixed-vs-random-effects.html"><a href="fixed-vs-random-effects.html#random-effects-stochastic-processes"><i class="fa fa-check"></i><b>6.2</b> Random effects: stochastic processes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html"><i class="fa fa-check"></i><b>7</b> How do LMMs work?</a><ul>
<li class="chapter" data-level="7.1" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#parameters-are-varied"><i class="fa fa-check"></i><b>7.1</b> Parameters are varied</a><ul>
<li class="chapter" data-level="" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#intercepts"><i class="fa fa-check"></i>Intercepts:</a></li>
<li class="chapter" data-level="" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#slopes"><i class="fa fa-check"></i>Slopes:</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#data-structure-is-taken-into-account"><i class="fa fa-check"></i><b>7.2</b> Data structure is taken into account</a></li>
<li class="chapter" data-level="7.3" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#challenge-2"><i class="fa fa-check"></i><b>7.3</b> Challenge 2</a></li>
</ul></li>
<li class="part"><span><b>Implementing LMM in <code>R</code></b></span></li>
<li class="chapter" data-level="8" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html"><i class="fa fa-check"></i><b>8</b> Mixed model protocol</a></li>
<li class="chapter" data-level="9" data-path="step-1-a-priori-model-building.html"><a href="step-1-a-priori-model-building.html"><i class="fa fa-check"></i><b>9</b> Step 1. <em>A priori</em> model building</a><ul>
<li class="chapter" data-level="9.1" data-path="step-1-a-priori-model-building.html"><a href="step-1-a-priori-model-building.html#check-data-structure"><i class="fa fa-check"></i><b>9.1</b> Check data structure</a></li>
<li class="chapter" data-level="9.2" data-path="step-1-a-priori-model-building.html"><a href="step-1-a-priori-model-building.html#check-collinearity"><i class="fa fa-check"></i><b>9.2</b> Check collinearity</a></li>
<li class="chapter" data-level="9.3" data-path="step-1-a-priori-model-building.html"><a href="step-1-a-priori-model-building.html#challenge-3"><i class="fa fa-check"></i><b>9.3</b> Challenge 3</a></li>
<li class="chapter" data-level="9.4" data-path="step-1-a-priori-model-building.html"><a href="step-1-a-priori-model-building.html#consider-scale"><i class="fa fa-check"></i><b>9.4</b> Consider scale</a></li>
<li class="chapter" data-level="9.5" data-path="step-1-a-priori-model-building.html"><a href="step-1-a-priori-model-building.html#do-you-need-a-lmm"><i class="fa fa-check"></i><b>9.5</b> Do you need a LMM?</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="step-2-code-potential-models-and-model-selection.html"><a href="step-2-code-potential-models-and-model-selection.html"><i class="fa fa-check"></i><b>10</b> Step 2. Code potential models and model selection</a><ul>
<li class="chapter" data-level="10.1" data-path="step-2-code-potential-models-and-model-selection.html"><a href="step-2-code-potential-models-and-model-selection.html#estimation-methods"><i class="fa fa-check"></i><b>10.1</b> Estimation methods</a></li>
<li class="chapter" data-level="10.2" data-path="step-2-code-potential-models-and-model-selection.html"><a href="step-2-code-potential-models-and-model-selection.html#different-model-structures"><i class="fa fa-check"></i><b>10.2</b> Different model structures</a></li>
<li class="chapter" data-level="10.3" data-path="step-2-code-potential-models-and-model-selection.html"><a href="step-2-code-potential-models-and-model-selection.html#challenge-4"><i class="fa fa-check"></i><b>10.3</b> Challenge 4</a></li>
<li class="chapter" data-level="10.4" data-path="step-2-code-potential-models-and-model-selection.html"><a href="step-2-code-potential-models-and-model-selection.html#challenge-5"><i class="fa fa-check"></i><b>10.4</b> Challenge 5</a></li>
<li class="chapter" data-level="10.5" data-path="step-2-code-potential-models-and-model-selection.html"><a href="step-2-code-potential-models-and-model-selection.html#comparing-models"><i class="fa fa-check"></i><b>10.5</b> Comparing models</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="step-3-model-validation.html"><a href="step-3-model-validation.html"><i class="fa fa-check"></i><b>11</b> Step 3. Model validation</a><ul>
<li class="chapter" data-level="11.1" data-path="step-3-model-validation.html"><a href="step-3-model-validation.html#check-the-homogeneity-of-the-variance"><i class="fa fa-check"></i><b>11.1</b> 1. Check the homogeneity of the variance</a></li>
<li class="chapter" data-level="11.2" data-path="step-3-model-validation.html"><a href="step-3-model-validation.html#check-the-independence-of-the-model-residuals-with-each-covariate"><i class="fa fa-check"></i><b>11.2</b> 2. Check the independence of the model residuals with each covariate</a></li>
<li class="chapter" data-level="11.3" data-path="step-3-model-validation.html"><a href="step-3-model-validation.html#check-the-normality-of-the-model-residuals"><i class="fa fa-check"></i><b>11.3</b> 3. Check the normality of the model residuals</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="step-4-interpretation-and-visualization.html"><a href="step-4-interpretation-and-visualization.html"><i class="fa fa-check"></i><b>12</b> Step 4. Interpretation and visualization</a><ul>
<li class="chapter" data-level="12.1" data-path="step-4-interpretation-and-visualization.html"><a href="step-4-interpretation-and-visualization.html#interpreting-our-model"><i class="fa fa-check"></i><b>12.1</b> Interpreting our model</a></li>
<li class="chapter" data-level="12.2" data-path="step-4-interpretation-and-visualization.html"><a href="step-4-interpretation-and-visualization.html#challenge-6"><i class="fa fa-check"></i><b>12.2</b> Challenge 6</a></li>
<li class="chapter" data-level="12.3" data-path="step-4-interpretation-and-visualization.html"><a href="step-4-interpretation-and-visualization.html#challenge-7"><i class="fa fa-check"></i><b>12.3</b> Challenge 7</a></li>
<li class="chapter" data-level="12.4" data-path="step-4-interpretation-and-visualization.html"><a href="step-4-interpretation-and-visualization.html#challenge-8"><i class="fa fa-check"></i><b>12.4</b> Challenge 8</a></li>
</ul></li>
<li class="part"><span><b>Generalized linear mixed models (GLMM) in <code>R</code></b></span></li>
<li class="chapter" data-level="13" data-path="introduction-to-glmm.html"><a href="introduction-to-glmm.html"><i class="fa fa-check"></i><b>13</b> Introduction to GLMM</a></li>
<li class="chapter" data-level="14" data-path="choose-an-error-distribution.html"><a href="choose-an-error-distribution.html"><i class="fa fa-check"></i><b>14</b> Choose an error distribution</a></li>
<li class="chapter" data-level="15" data-path="poisson-glmm.html"><a href="poisson-glmm.html"><i class="fa fa-check"></i><b>15</b> Poisson GLMM</a></li>
<li class="chapter" data-level="16" data-path="negative-binomial-glmm.html"><a href="negative-binomial-glmm.html"><i class="fa fa-check"></i><b>16</b> Negative binomial GLMM</a></li>
<li class="chapter" data-level="17" data-path="poisson-lognormal-glmm.html"><a href="poisson-lognormal-glmm.html"><i class="fa fa-check"></i><b>17</b> Poisson-lognormal GLMM</a></li>
<li class="part"><span><b>Model selection</b></span></li>
<li class="chapter" data-level="18" data-path="selection-methods.html"><a href="selection-methods.html"><i class="fa fa-check"></i><b>18</b> Selection Methods</a><ul>
<li class="chapter" data-level="18.1" data-path="selection-methods.html"><a href="selection-methods.html#challenge-9"><i class="fa fa-check"></i><b>18.1</b> Challenge 9</a></li>
</ul></li>
<li class="part"><span><b>Additional LMM and GLMM resources</b></span></li>
<li class="chapter" data-level="19" data-path="additional-resources.html"><a href="additional-resources.html"><i class="fa fa-check"></i><b>19</b> Additional resources</a></li>
<li class="chapter" data-level="20" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>20</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/qcbsRworkshops" target="blank">QCBS R Workshop Series</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!------------------------ Hero Image Container --------------------------> 

<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <script src="https://kit.fontawesome.com/6a26f47516.js"></script>
  <script src="assets/qcbs-hideOutput.js"></script>
  <link href="assets/qcbs-style.css" rel="stylesheet">
</head>



<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/images/jean-philippe-delberghe-75xPHEQBmvA-unsplash_hero_image.jpg">
</div>
<div id="step-2.-code-potential-models-and-model-selection" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> Step 2. Code potential models and model selection</h1>
<p><strong>Translate this model…</strong></p>
<p><span class="math display">\[TP_{ijk} \sim Length_i + Lake_j + Species_k + \epsilon_{ijk}\]</span></p>
<p><strong>… into R code</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="step-2-code-potential-models-and-model-selection.html#cb15-1"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb15-2"><a href="step-2-code-potential-models-and-model-selection.html#cb15-2"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Z_TP ~ Z_Length + (1 | Lake) + (1 | Fish_Species)
##    Data: fish.data
## REML criterion at convergence: 72.4662
## Random effects:
##  Groups       Name        Std.Dev.
##  Lake         (Intercept) 0.4516  
##  Fish_Species (Intercept) 0.9301  
##  Residual                 0.2605  
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## Fixed Effects:
## (Intercept)     Z_Length  
##   9.752e-14    4.198e-01</code></pre>
<p>Where:</p>
<ul>
<li><code>lmer</code> -&gt; “linear mixed model” function from <code>lme4</code> package</li>
<li><code>(1 | Lake)</code> -&gt; indicate varying intercepts among lakes</li>
<li><code>REML = TRUE</code> -&gt; estimation method</li>
</ul>
<div id="estimation-methods" class="section level2">
<h2><span class="header-section-number">10.1</span> Estimation methods</h2>
<p>REML (<em>Restricted Maximum Likelihood</em>) is the default method in <code>lmer</code> (see <code>?lmer</code>).</p>
<p>The <em>Maximum Likelihood</em> (ML) method underestimate model variances by a factor of <span class="math inline">\((n-k)/n\)</span>, where <span class="math inline">\(k\)</span> is the number of fixed effects. The <em>REML</em> method corrects for this bias.</p>
<p>REML estimates can be used when comparing models with the same fixed effects (i.e. nested models). However, if you are comparing models where the fixed effects differ among models then maximum likelihood should be used to fit parameters as this method is not dependent on the coefficients of the fixed effects. Fitting using maximum likelihood is done by setting <code>REML=FALSE</code> in the lmer command.</p>
<p>See this <a href="https://towardsdatascience.com/maximum-likelihood-ml-vs-reml-78cf79bef2cf">article</a> for more information on the difference between ML and REML.</p>
<p><strong>In summary:</strong></p>
<ul>
<li><p><strong>REML</strong> to compare models with <strong>nested random effects</strong> and the same fixed effect structure</p></li>
<li><p><strong>ML</strong> to compare models with <strong>nested fixed effects</strong> and the same random effect structure</p></li>
<li><p><strong>ML</strong> to compare models <strong>with and without random effects</strong></p></li>
</ul>
</div>
<div id="different-model-structures" class="section level2">
<h2><span class="header-section-number">10.2</span> Different model structures</h2>
<p><strong>What if we want the slopes to vary?</strong></p>
<p><img src="images/fig_22_w5.png" /></p>
<p><strong>Let’s look at different model structures:</strong></p>
<ul>
<li><p><code>(1 | Lake)</code> random effect by lake at the intrecept</p></li>
<li><p><code>(1 + Z_Length | Lake)</code> random effect by lake at the intercept and slope in response to the body length (NB: (<code>Z_Length | Lake)</code> gives the same random structure)</p></li>
<li><p><code>(-1 + Z_Length | Lake)</code> to have only the random effect at the slope</p></li>
<li><p><code>(1 | Lake) + (1 | Species)</code> for crossed random effects</p></li>
<li><p><code>(1 | Lake:Fish_Species)</code> for the interaction between 2 random effects</p></li>
<li><p>If your dataset includes nested random effects, you could use <code>/</code> to specify them, e.g. <code>(1 | factor1 / factor2)</code> if <code>factor2</code> is nested in <code>factor1</code> (<a href="https://stats.stackexchange.com/questions/228800/crossed-vs-nested-random-effects-how-do-they-differ-and-how-are-they-specified">see stack-exchange</a>)</p></li>
</ul>
</div>
<div id="challenge-4" class="section level2">
<h2><span class="header-section-number">10.3</span> Challenge 4</h2>
<p>Re-write the following code so that the <strong>slopes</strong> of the relationship between trophic position and body length <strong>vary by lake and species</strong>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="step-2-code-potential-models-and-model-selection.html#cb17-1"></a><span class="co"># Challenge 4: Can you re-write this code so that the slopes</span></span>
<span id="cb17-2"><a href="step-2-code-potential-models-and-model-selection.html#cb17-2"></a><span class="co"># between trophic position and body length vary by lake and</span></span>
<span id="cb17-3"><a href="step-2-code-potential-models-and-model-selection.html#cb17-3"></a><span class="co"># species?</span></span>
<span id="cb17-4"><a href="step-2-code-potential-models-and-model-selection.html#cb17-4"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb17-5"><a href="step-2-code-potential-models-and-model-selection.html#cb17-5"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Z_TP ~ Z_Length + (1 | Lake) + (1 | Fish_Species)
##    Data: fish.data
## REML criterion at convergence: 72.4662
## Random effects:
##  Groups       Name        Std.Dev.
##  Lake         (Intercept) 0.4516  
##  Fish_Species (Intercept) 0.9301  
##  Residual                 0.2605  
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## Fixed Effects:
## (Intercept)     Z_Length  
##   9.752e-14    4.198e-01</code></pre>
<hr />
<div id="challenge-4-solution" class="section level4 unnumbered">
<h4><strong>Challenge 4 Solution:</strong></h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="step-2-code-potential-models-and-model-selection.html#cb19-1"></a><span class="co"># Challenge 4 solution:</span></span>
<span id="cb19-2"><a href="step-2-code-potential-models-and-model-selection.html#cb19-2"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span></span>
<span id="cb19-3"><a href="step-2-code-potential-models-and-model-selection.html#cb19-3"></a><span class="st">    </span>Fish_Species), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: 
## Z_TP ~ Z_Length + (1 + Z_Length | Lake) + (1 + Z_Length | Fish_Species)
##    Data: fish.data
## REML criterion at convergence: 20.5786
## Random effects:
##  Groups       Name        Std.Dev. Corr 
##  Lake         (Intercept) 0.45279       
##               Z_Length    0.02378  -0.82
##  Fish_Species (Intercept) 0.93103       
##               Z_Length    0.15728  1.00 
##  Residual                 0.22341       
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## Fixed Effects:
## (Intercept)     Z_Length  
##  -0.0009025    0.4223738  
## optimizer (nloptwrap) convergence code: 0 (OK) ; 0 optimizer warnings; 1 lme4 warnings</code></pre>
<hr />
</div>
</div>
<div id="challenge-5" class="section level2">
<h2><span class="header-section-number">10.4</span> Challenge 5</h2>
<p>To determine if you have built the best mixed model based on your prior knowledge, you should compare this <em>a priori</em> model to other alternative models.</p>
<p>With the dataset you are working on, there are several alternative models that might better fit your data. For challenge 5, make a list of 7 alternative models that could be compared to this one:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="step-2-code-potential-models-and-model-selection.html#cb22-1"></a><span class="co"># Challenge 5: Make a list of 7 alternative models that could</span></span>
<span id="cb22-2"><a href="step-2-code-potential-models-and-model-selection.html#cb22-2"></a><span class="co"># be compared to this initial model:</span></span>
<span id="cb22-3"><a href="step-2-code-potential-models-and-model-selection.html#cb22-3"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb22-4"><a href="step-2-code-potential-models-and-model-selection.html#cb22-4"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Z_TP ~ Z_Length + (1 | Lake) + (1 | Fish_Species)
##    Data: fish.data
## REML criterion at convergence: 72.4662
## Random effects:
##  Groups       Name        Std.Dev.
##  Lake         (Intercept) 0.4516  
##  Fish_Species (Intercept) 0.9301  
##  Residual                 0.2605  
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## Fixed Effects:
## (Intercept)     Z_Length  
##   9.752e-14    4.198e-01</code></pre>
<p><em>Note: If we had different fixed effects between the models or a model without random effects, we would have to specify <code>REML = FALSE</code> to compare with likelihood methods like AIC.</em></p>
<hr />
<div id="challenge-5-solution" class="section level4 unnumbered">
<h4><strong>Challenge 5 Solution:</strong></h4>
<p>We first will also build the <strong>basic linear model</strong> <code>lm()</code> because it is always useful to see the variation in the AICc values (we will discuss these in more detail in the next section).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="step-2-code-potential-models-and-model-selection.html#cb24-1"></a><span class="co"># Challenge 5 solution: Basic linear model</span></span>
<span id="cb24-2"><a href="step-2-code-potential-models-and-model-selection.html#cb24-2"></a>M0 &lt;-<span class="st"> </span><span class="kw">lm</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length, <span class="dt">data =</span> fish.data)</span></code></pre></div>
<p>In order to compare this model to the LMMs, it is important to <strong>change the estimation method to ML (<code>REML=FALSE</code>)</strong> for all other models because <code>lm()</code> does not use the same estimation method as <code>lmer()</code>.</p>
<p>Let’s look at the other models you could have written (note <code>REML = FALSE</code>):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="step-2-code-potential-models-and-model-selection.html#cb25-1"></a><span class="co"># Challenge 5 solution, other potential models Note that REML</span></span>
<span id="cb25-2"><a href="step-2-code-potential-models-and-model-selection.html#cb25-2"></a><span class="co"># = FALSE in order to compare with the basic linear model</span></span>
<span id="cb25-3"><a href="step-2-code-potential-models-and-model-selection.html#cb25-3"></a><span class="co"># where estimation method = ML</span></span>
<span id="cb25-4"><a href="step-2-code-potential-models-and-model-selection.html#cb25-4"></a></span>
<span id="cb25-5"><a href="step-2-code-potential-models-and-model-selection.html#cb25-5"></a><span class="co"># Basic linear model / Linear model with no random effects</span></span>
<span id="cb25-6"><a href="step-2-code-potential-models-and-model-selection.html#cb25-6"></a>M0 &lt;-<span class="st"> </span><span class="kw">lm</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length, <span class="dt">data =</span> fish.data)</span>
<span id="cb25-7"><a href="step-2-code-potential-models-and-model-selection.html#cb25-7"></a><span class="co"># Full model with varying intercepts</span></span>
<span id="cb25-8"><a href="step-2-code-potential-models-and-model-selection.html#cb25-8"></a>M1 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), </span>
<span id="cb25-9"><a href="step-2-code-potential-models-and-model-selection.html#cb25-9"></a>    <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb25-10"><a href="step-2-code-potential-models-and-model-selection.html#cb25-10"></a><span class="co"># Full model with varying intercepts and slopes</span></span>
<span id="cb25-11"><a href="step-2-code-potential-models-and-model-selection.html#cb25-11"></a>M2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-12"><a href="step-2-code-potential-models-and-model-selection.html#cb25-12"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="step-2-code-potential-models-and-model-selection.html#cb27-1"></a><span class="co"># No Lake, varying intercepts only</span></span>
<span id="cb27-2"><a href="step-2-code-potential-models-and-model-selection.html#cb27-2"></a>M3 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb27-3"><a href="step-2-code-potential-models-and-model-selection.html#cb27-3"></a>    <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb27-4"><a href="step-2-code-potential-models-and-model-selection.html#cb27-4"></a><span class="co"># No Species, varying intercepts only</span></span>
<span id="cb27-5"><a href="step-2-code-potential-models-and-model-selection.html#cb27-5"></a>M4 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb27-6"><a href="step-2-code-potential-models-and-model-selection.html#cb27-6"></a><span class="co"># No Lake, varying intercepts and slopes</span></span>
<span id="cb27-7"><a href="step-2-code-potential-models-and-model-selection.html#cb27-7"></a>M5 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb27-8"><a href="step-2-code-potential-models-and-model-selection.html#cb27-8"></a>    <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="step-2-code-potential-models-and-model-selection.html#cb29-1"></a><span class="co"># No Species, varying intercepts and slopes</span></span>
<span id="cb29-2"><a href="step-2-code-potential-models-and-model-selection.html#cb29-2"></a>M6 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, </span>
<span id="cb29-3"><a href="step-2-code-potential-models-and-model-selection.html#cb29-3"></a>    <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="step-2-code-potential-models-and-model-selection.html#cb31-1"></a><span class="co"># Full model with varying intercepts and slopes only varying</span></span>
<span id="cb31-2"><a href="step-2-code-potential-models-and-model-selection.html#cb31-2"></a><span class="co"># by lake</span></span>
<span id="cb31-3"><a href="step-2-code-potential-models-and-model-selection.html#cb31-3"></a>M7 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span></span>
<span id="cb31-4"><a href="step-2-code-potential-models-and-model-selection.html#cb31-4"></a><span class="st">    </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="step-2-code-potential-models-and-model-selection.html#cb33-1"></a><span class="co"># Full model with varying intercepts and slopes only varying</span></span>
<span id="cb33-2"><a href="step-2-code-potential-models-and-model-selection.html#cb33-2"></a><span class="co"># by species</span></span>
<span id="cb33-3"><a href="step-2-code-potential-models-and-model-selection.html#cb33-3"></a>M8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb33-4"><a href="step-2-code-potential-models-and-model-selection.html#cb33-4"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<p><strong>When fitting LMMs with <code>lmer()</code>, you may encounter some errors or warnings such as:</strong></p>
<ul>
<li><p><code>boundary (singular) fit: see ?isSingular</code>, see <a href="https://stats.stackexchange.com/questions/378939/dealing-with-singular-fit-in-mixed-models">this discussion on stack-exchange</a></p></li>
<li><p><code>Model failed to converge with max|grad| ...</code>, see <a href="https://stats.stackexchange.com/questions/242109/model-failed-to-converge-warning-in-lmer">this discussion on stack-exchange</a></p></li>
</ul>
<p>Here a <a href="https://rdrr.io/cran/lme4/man/troubleshooting.html">list</a> of possible problems and how to troubleshoot them.</p>
</div>
</div>
<div id="comparing-models" class="section level2">
<h2><span class="header-section-number">10.5</span> Comparing models</h2>
<p>Now that we have a list of potential models, we want to compare them to each other to select the one(s) with the highest predictive power given the data.</p>
<p>Models can be compared by using the <code>AICc</code> function from the<code>MuMIn</code> package. The Akaike Information Criterion (AIC) is a <strong>measure of model quality</strong> that can be used to compare models.</p>
<p><code>AICc</code> corrects for bias created by small sample sizes.</p>
<p>In order the find the AICc value of a model, use:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="step-2-code-potential-models-and-model-selection.html#cb35-1"></a><span class="co"># Load MuMIn package which allows us to find AICc values for</span></span>
<span id="cb35-2"><a href="step-2-code-potential-models-and-model-selection.html#cb35-2"></a><span class="co"># our models</span></span>
<span id="cb35-3"><a href="step-2-code-potential-models-and-model-selection.html#cb35-3"></a><span class="kw">library</span>(MuMIn)</span>
<span id="cb35-4"><a href="step-2-code-potential-models-and-model-selection.html#cb35-4"></a></span>
<span id="cb35-5"><a href="step-2-code-potential-models-and-model-selection.html#cb35-5"></a><span class="co"># Find AICc value for our first model (Basic linear model)</span></span>
<span id="cb35-6"><a href="step-2-code-potential-models-and-model-selection.html#cb35-6"></a>MuMIn<span class="op">::</span><span class="kw">AICc</span>(M1)</span></code></pre></div>
<pre><code>## [1] 77.30499</code></pre>
<p>To group all AICc values into a single table, use <code>MuMIn::model.sel()</code> to calculate AICc for each model (along with other outputs) and then select only the columns of interest to print in a table.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="step-2-code-potential-models-and-model-selection.html#cb37-1"></a><span class="co"># To group all AICc values into a single table, we can use</span></span>
<span id="cb37-2"><a href="step-2-code-potential-models-and-model-selection.html#cb37-2"></a><span class="co"># MuMIn::model.sel() to calculate AICc for each model (along</span></span>
<span id="cb37-3"><a href="step-2-code-potential-models-and-model-selection.html#cb37-3"></a><span class="co"># with other outputs)</span></span>
<span id="cb37-4"><a href="step-2-code-potential-models-and-model-selection.html#cb37-4"></a>AIC.table &lt;-<span class="st"> </span>MuMIn<span class="op">::</span><span class="kw">model.sel</span>(M0, M1, M2, M3, M4, M5, M6, M7, </span>
<span id="cb37-5"><a href="step-2-code-potential-models-and-model-selection.html#cb37-5"></a>    M8)</span>
<span id="cb37-6"><a href="step-2-code-potential-models-and-model-selection.html#cb37-6"></a></span>
<span id="cb37-7"><a href="step-2-code-potential-models-and-model-selection.html#cb37-7"></a><span class="co"># Then we can select only the columns of interest to print</span></span>
<span id="cb37-8"><a href="step-2-code-potential-models-and-model-selection.html#cb37-8"></a><span class="co"># into a table `df` is the degree of freedom `logLik` is the</span></span>
<span id="cb37-9"><a href="step-2-code-potential-models-and-model-selection.html#cb37-9"></a><span class="co"># loglikelihood `delta` is the AICc difference with the</span></span>
<span id="cb37-10"><a href="step-2-code-potential-models-and-model-selection.html#cb37-10"></a><span class="co"># lowest value</span></span>
<span id="cb37-11"><a href="step-2-code-potential-models-and-model-selection.html#cb37-11"></a>(AIC.table &lt;-<span class="st"> </span>AIC.table[, <span class="kw">c</span>(<span class="st">&quot;df&quot;</span>, <span class="st">&quot;logLik&quot;</span>, <span class="st">&quot;AICc&quot;</span>, <span class="st">&quot;delta&quot;</span>)])</span></code></pre></div>
<pre><code>##    df      logLik      AICc      delta
## M8  7   -8.597929  31.84702   0.000000
## M2  9   -8.216019  35.49086   3.643839
## M1  5  -33.480080  77.30499  45.457965
## M7  7  -33.186374  81.02391  49.176890
## M5  6 -128.310995 269.10754 237.260517
## M3  4 -134.532965 277.29450 245.447480
## M4  4 -224.715763 457.66010 425.813076
## M6  6 -224.671201 461.82795 429.980930
## M0  3 -236.861362 479.85909 448.012065</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="step-2-code-potential-models-and-model-selection.html#cb39-1"></a><span class="co"># For more information on the other outputs/results returned</span></span>
<span id="cb39-2"><a href="step-2-code-potential-models-and-model-selection.html#cb39-2"></a><span class="co"># by the function `model.sel()`, see `?model.sel`.</span></span></code></pre></div>
<p>Where:</p>
<ul>
<li><code>df</code> is the degree of freedom</li>
<li><code>logLik</code> is the loglikelihood</li>
<li><code>delta</code> is the AICc difference with the lowest value</li>
</ul>
<p>We only displayed part of the results returned by the function <code>model.sel()</code>, see <code>?model.sel</code> for more information.</p>
<hr />
<p><strong>What do these AICc values mean?</strong></p>
<ul>
<li>The model with the smallest AICc has the highest predictive power.</li>
<li>Some suggest that if models are within 2 AICc units of each other then they are equally plausible.</li>
<li>Let’s take a closer look at M8 and M2. We can exclude other models because they have such higher AICc.</li>
</ul>
<p><em>Note that we use now REML (i.e. <code>REML = TRUE</code>) as we are comparing two models with nested random effects and the same fixed effect structure.</em></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="step-2-code-potential-models-and-model-selection.html#cb40-1"></a><span class="co"># Let&#39;s take a closer look at M8 and M2. We can exclude other</span></span>
<span id="cb40-2"><a href="step-2-code-potential-models-and-model-selection.html#cb40-2"></a><span class="co"># model because they have such higher AICc Because we are</span></span>
<span id="cb40-3"><a href="step-2-code-potential-models-and-model-selection.html#cb40-3"></a><span class="co"># comparing two mixed effect models, we can set `REML = TRUE`</span></span>
<span id="cb40-4"><a href="step-2-code-potential-models-and-model-selection.html#cb40-4"></a><span class="co"># when generating M8 and M2</span></span>
<span id="cb40-5"><a href="step-2-code-potential-models-and-model-selection.html#cb40-5"></a>M8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb40-6"><a href="step-2-code-potential-models-and-model-selection.html#cb40-6"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="step-2-code-potential-models-and-model-selection.html#cb42-1"></a>M2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb42-2"><a href="step-2-code-potential-models-and-model-selection.html#cb42-2"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="step-2-code-potential-models-and-model-selection.html#cb44-1"></a><span class="co"># Now let&#39;s print a table in order to compare M2 and M8</span></span>
<span id="cb44-2"><a href="step-2-code-potential-models-and-model-selection.html#cb44-2"></a>MuMIn<span class="op">::</span><span class="kw">model.sel</span>(M2, M8)[, <span class="kw">c</span>(<span class="st">&quot;df&quot;</span>, <span class="st">&quot;logLik&quot;</span>, <span class="st">&quot;AICc&quot;</span>, <span class="st">&quot;delta&quot;</span>)]</span></code></pre></div>
<pre><code>##    df    logLik     AICc    delta
## M8  7 -10.84011 36.33137 0.000000
## M2  9 -10.28932 39.63747 3.306098</code></pre>
<p>Model <code>M8</code> seems to be the best among all models that we tested.</p>
<hr />
<p><strong>What is the structure of the best model?</strong></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="step-2-code-potential-models-and-model-selection.html#cb46-1"></a><span class="co"># Let&#39;s take a look at the best model again, what is it&#39;s</span></span>
<span id="cb46-2"><a href="step-2-code-potential-models-and-model-selection.html#cb46-2"></a><span class="co"># structure?</span></span>
<span id="cb46-3"><a href="step-2-code-potential-models-and-model-selection.html#cb46-3"></a>M8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-4"><a href="step-2-code-potential-models-and-model-selection.html#cb46-4"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="step-2-code-potential-models-and-model-selection.html#cb48-1"></a><span class="co"># Both the intercepts and slopes of the relationship between</span></span>
<span id="cb48-2"><a href="step-2-code-potential-models-and-model-selection.html#cb48-2"></a><span class="co"># trophic position and length may vary by fish species, but</span></span>
<span id="cb48-3"><a href="step-2-code-potential-models-and-model-selection.html#cb48-3"></a><span class="co"># only the intercepts may vary by lake.</span></span></code></pre></div>
<p>Both the intercepts and slopes of the relationship between trophic position and length may vary by fish species, but only the intercepts may vary by lake.</p>
<div class="two-col">
<p><img src="images/fig_9_w5.png" /><br />
<img src="images/fig_8_w5.png" /></p>
</div>
<p>Once the best model is selected, the estimation method must be reset to <code>REML = TRUE</code>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="step-2-code-potential-models-and-model-selection.html#cb49-1"></a><span class="co"># Once the best model is selected, the estimation method must</span></span>
<span id="cb49-2"><a href="step-2-code-potential-models-and-model-selection.html#cb49-2"></a><span class="co"># be reset to `REML = TRUE`.</span></span>
<span id="cb49-3"><a href="step-2-code-potential-models-and-model-selection.html#cb49-3"></a>M8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb49-4"><a href="step-2-code-potential-models-and-model-selection.html#cb49-4"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
</div>
</div>
<hr>
<center> 
  <div class="footer">
      All the content of the workshop series is under a <a href="https://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="step-1-a-priori-model-building.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="step-3-model-validation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
