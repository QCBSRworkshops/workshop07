<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Mixed model protocol | Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)</title>
  <meta name="description" content="Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Mixed model protocol | Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/qcbsRworkshops/" />
  <meta property="og:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />
  <meta property="og:description" content="Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta name="github-repo" content="qcbsRworkshops/workshop09" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Mixed model protocol | Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)" />
  
  <meta name="twitter:description" content="Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta name="twitter:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />

<meta name="author" content="Developed and maintained by the contributors of the QCBS R Workshop Series" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="how-do-lmms-work.html"/>
<link rel="next" href="note-on-estimation-methods.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/qcbs-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/images/csbq_logo_gray_accueil.png"></a></li>
<link rel="icon" type="image/png" href="assets/images/favicon.ico"/>

<li class="divider"></li>
<li class="part"><span><b>QCBS R Workshop Series</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1</b> Code of conduct</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#expected-behaviour"><i class="fa fa-check"></i><b>0.1.1</b> Expected behaviour</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#unacceptable-behaviour"><i class="fa fa-check"></i><b>0.1.2</b> Unacceptable behaviour</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>0.2</b> Contributors</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#contributing"><i class="fa fa-check"></i><b>0.3</b> Contributing</a></li>
</ul></li>
<li class="part"><span><b>Linear mixed models (LMM) in <code>R</code></b></span></li>
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning objectives</a></li>
<li class="chapter" data-level="2" data-path="preparing-for-the-workshop.html"><a href="preparing-for-the-workshop.html"><i class="fa fa-check"></i><b>2</b> Preparing for the workshop</a></li>
<li class="chapter" data-level="3" data-path="why-choose-mixed-models.html"><a href="why-choose-mixed-models.html"><i class="fa fa-check"></i><b>3</b> Why choose mixed models?</a></li>
<li class="chapter" data-level="4" data-path="starting-with-a-question.html"><a href="starting-with-a-question.html"><i class="fa fa-check"></i><b>4</b> Starting with a question</a><ul>
<li class="chapter" data-level="4.1" data-path="starting-with-a-question.html"><a href="starting-with-a-question.html#challenge-1"><i class="fa fa-check"></i><b>4.1</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html"><i class="fa fa-check"></i><b>5</b> Analyzing the data</a><ul>
<li class="chapter" data-level="5.1" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html#separate"><i class="fa fa-check"></i><b>5.1</b> Separate</a></li>
<li class="chapter" data-level="5.2" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html#lump"><i class="fa fa-check"></i><b>5.2</b> Lump</a></li>
<li class="chapter" data-level="5.3" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html#is-there-a-third-option"><i class="fa fa-check"></i><b>5.3</b> Is there a third option?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="fixed-vs-random-effects.html"><a href="fixed-vs-random-effects.html"><i class="fa fa-check"></i><b>6</b> Fixed vs. random effects</a><ul>
<li class="chapter" data-level="6.1" data-path="fixed-vs-random-effects.html"><a href="fixed-vs-random-effects.html#fixed-effects-deterministic-processes"><i class="fa fa-check"></i><b>6.1</b> Fixed effects: deterministic processes</a></li>
<li class="chapter" data-level="6.2" data-path="fixed-vs-random-effects.html"><a href="fixed-vs-random-effects.html#random-effects-stochastic-processes"><i class="fa fa-check"></i><b>6.2</b> Random effects: stochastic processes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html"><i class="fa fa-check"></i><b>7</b> How do LMMs work?</a><ul>
<li class="chapter" data-level="7.1" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#parameters-are-varied"><i class="fa fa-check"></i><b>7.1</b> Parameters are varied</a><ul>
<li class="chapter" data-level="" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#intercepts"><i class="fa fa-check"></i>Intercepts:</a></li>
<li class="chapter" data-level="" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#slopes"><i class="fa fa-check"></i>Slopes:</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#data-structure-is-taken-into-account"><i class="fa fa-check"></i><b>7.2</b> Data structure is taken into account</a></li>
<li class="chapter" data-level="7.3" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#challenge-2"><i class="fa fa-check"></i><b>7.3</b> Challenge 2</a></li>
</ul></li>
<li class="part"><span><b>Implementing LMM in <code>R</code></b></span></li>
<li class="chapter" data-level="8" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html"><i class="fa fa-check"></i><b>8</b> Mixed model protocol</a><ul>
<li><a href="mixed-model-protocol.html#step-1.-a-priori-model-building">Step 1. <em>A priori</em> model building</a><ul>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#check-data-structure"><i class="fa fa-check"></i>Check data structure</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#check-collinearity"><i class="fa fa-check"></i>Check collinearity</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#challenge-3"><i class="fa fa-check"></i>Challenge 3</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#consider-scale"><i class="fa fa-check"></i>Consider scale</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#do-you-need-a-lmm"><i class="fa fa-check"></i>Do you need a LMM?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#step-2.-code-potential-models-and-model-selection"><i class="fa fa-check"></i>Step 2. Code potential models and model selection</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="note-on-estimation-methods.html"><a href="note-on-estimation-methods.html"><i class="fa fa-check"></i><b>9</b> Note on estimation methods</a></li>
<li class="chapter" data-level="10" data-path="step-2-code-potential-models.html"><a href="step-2-code-potential-models.html"><i class="fa fa-check"></i><b>10</b> Step 2. Code potential models</a></li>
<li class="chapter" data-level="11" data-path="solution-cube.html"><a href="solution-cube.html"><i class="fa fa-check"></i><b>11</b> Solution <img src="" alt=":cube" /></a></li>
<li class="chapter" data-level="12" data-path="challenge-5-cube.html"><a href="challenge-5-cube.html"><i class="fa fa-check"></i><b>12</b> Challenge 5 <img src="" alt=":cube" /></a></li>
<li class="chapter" data-level="13" data-path="solution-cube-1.html"><a href="solution-cube-1.html"><i class="fa fa-check"></i><b>13</b> Solution <img src="" alt=":cube" /></a></li>
<li class="chapter" data-level="14" data-path="step-2-model-selection.html"><a href="step-2-model-selection.html"><i class="fa fa-check"></i><b>14</b> Step 2. Model selection</a></li>
<li class="chapter" data-level="15" data-path="step-2-model-selection-1.html"><a href="step-2-model-selection-1.html"><i class="fa fa-check"></i><b>15</b> Step 2. Model selection</a></li>
<li class="chapter" data-level="16" data-path="step-2-model-selection-2.html"><a href="step-2-model-selection-2.html"><i class="fa fa-check"></i><b>16</b> Step 2. Model selection</a></li>
<li class="chapter" data-level="17" data-path="step-2-model-selection-3.html"><a href="step-2-model-selection-3.html"><i class="fa fa-check"></i><b>17</b> Step 2. Model selection</a></li>
<li class="chapter" data-level="18" data-path="solution.html"><a href="solution.html"><i class="fa fa-check"></i><b>18</b> Solution</a></li>
<li class="part"><span><b>Generalized linear mixed models (GLMM) in <code>R</code></b></span></li>
<li class="chapter" data-level="19" data-path="generalized-linear-mixed-models-glmms.html"><a href="generalized-linear-mixed-models-glmms.html"><i class="fa fa-check"></i><b>19</b> Generalized linear mixed models (GLMMs)</a></li>
<li class="chapter" data-level="20" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html"><i class="fa fa-check"></i><b>20</b> Structure in dataset</a><ul>
<li class="chapter" data-level="20.1" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html#poisson-glmm"><i class="fa fa-check"></i><b>20.1</b> Poisson GLMM</a></li>
<li class="chapter" data-level="20.2" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html#negative-binomial-poisson-gamma-glmm"><i class="fa fa-check"></i><b>20.2</b> Negative binomial (Poisson-gamma) GLMM</a></li>
<li class="chapter" data-level="20.3" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html#poisson-lognormal-glmm"><i class="fa fa-check"></i><b>20.3</b> Poisson-lognormal GLMM</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="random-intercepts.html"><a href="random-intercepts.html"><i class="fa fa-check"></i><b>21</b> Random intercepts</a><ul>
<li class="chapter" data-level="21.1" data-path="random-intercepts.html"><a href="random-intercepts.html#parameter-plots"><i class="fa fa-check"></i><b>21.1</b> Parameter plots</a></li>
<li class="chapter" data-level="21.2" data-path="random-intercepts.html"><a href="random-intercepts.html#random-intercept-plots"><i class="fa fa-check"></i><b>21.2</b> Random intercept plots</a></li>
<li class="chapter" data-level="21.3" data-path="random-intercepts.html"><a href="random-intercepts.html#random-slopes"><i class="fa fa-check"></i><b>21.3</b> Random slopes</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="final-model.html"><a href="final-model.html"><i class="fa fa-check"></i><b>22</b> Final model</a></li>
<li class="part"><span><b>Final considerations</b></span></li>
<li class="chapter" data-level="23" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>23</b> Summary</a></li>
<li class="chapter" data-level="24" data-path="additional-resources.html"><a href="additional-resources.html"><i class="fa fa-check"></i><b>24</b> Additional resources</a><ul>
<li class="chapter" data-level="24.1" data-path="additional-resources.html"><a href="additional-resources.html#lmm-textbooks"><i class="fa fa-check"></i><b>24.1</b> LMM Textbooks</a></li>
<li class="chapter" data-level="24.2" data-path="additional-resources.html"><a href="additional-resources.html#glmm-resources"><i class="fa fa-check"></i><b>24.2</b> GLMM resources</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>25</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/qcbsRworkshops" target="blank">QCBS R Workshop Series</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!------------------------ Hero Image Container --------------------------> 

<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <script src="https://kit.fontawesome.com/6a26f47516.js"></script>
  <script src="assets/qcbs-hideOutput.js"></script>
  <link href="assets/qcbs-style.css" rel="stylesheet">
</head>



<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/images/jean-philippe-delberghe-75xPHEQBmvA-unsplash_hero_image.jpg">
</div>
<div id="mixed-model-protocol" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Mixed model protocol</h1>
<ul>
<li><strong>Step 1.</strong> <em>A priori</em> model building and data exploration</li>
<li><strong>Step 2.</strong> Code potential models and model selection</li>
<li><strong>Step 3.</strong> Model validation</li>
<li><strong>Step 4.</strong> Model interpretation and visualization</li>
</ul>
<div id="step-1.-a-priori-model-building" class="section level2 unnumbered">
<h2>Step 1. <em>A priori</em> model building</h2>
<p><strong>What we know <em>a priori</em>:</strong></p>
<p>We want to determine if the trophic position can be predicted by body length, while taking into account the variation between species and lakes. So we want a model that looks like this:</p>
<p><span class="math display">\[PT_{ijk} \sim Length_i + Lake_j + Species_k + \epsilon_{ijk}\]</span></p>
<div id="check-data-structure" class="section level3 unnumbered">
<h3>Check data structure</h3>
<p><strong>Does the data have the right structure?</strong></p>
<p>Look at the data structure:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="mixed-model-protocol.html#cb6-1"></a><span class="co"># Look at data structure</span></span>
<span id="cb6-2"><a href="mixed-model-protocol.html#cb6-2"></a><span class="kw">str</span>(fish.data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    180 obs. of  4 variables:
##  $ Lake        : chr  &quot;L1&quot; &quot;L1&quot; &quot;L1&quot; &quot;L1&quot; ...
##  $ Fish_Species: chr  &quot;S1&quot; &quot;S1&quot; &quot;S1&quot; &quot;S1&quot; ...
##  $ Fish_Length : num  105 195 294 414 237 ...
##  $ Trophic_Pos : num  2.6 2.7 2.74 2.74 2.79 ...</code></pre>
<p>Now look at the distribution of samples for each factor:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="mixed-model-protocol.html#cb8-1"></a><span class="co"># Look at the distribution of samples for each factor</span></span>
<span id="cb8-2"><a href="mixed-model-protocol.html#cb8-2"></a><span class="kw">table</span>(fish.data[, <span class="kw">c</span>(<span class="st">&quot;Lake&quot;</span>, <span class="st">&quot;Fish_Species&quot;</span>)])</span></code></pre></div>
<pre><code>##     Fish_Species
## Lake S1 S2 S3
##   L1 10 10 10
##   L2 10 10 10
##   L3 10 10 10
##   L4 10 10 10
##   L5 10 10 10
##   L6 10 10 10</code></pre>
<p>This dataset is perfectly balanced, but <strong>mixed models can be used to analyze unbalanced experimental plans</strong>, as it is often the case in ecology!</p>
<p>Let’s also look at the distribution of continuous variables:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="mixed-model-protocol.html#cb10-1"></a><span class="co"># Look at the distribution of continuous variables:</span></span>
<span id="cb10-2"><a href="mixed-model-protocol.html#cb10-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb10-3"><a href="mixed-model-protocol.html#cb10-3"></a><span class="kw">hist</span>(fish.data<span class="op">$</span>Fish_Length, <span class="dt">xlab =</span> <span class="st">&quot;Length (mm)&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb10-4"><a href="mixed-model-protocol.html#cb10-4"></a><span class="kw">hist</span>(fish.data<span class="op">$</span>Trophic_Pos, <span class="dt">xlab =</span> <span class="st">&quot;Trophic position&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Major deviations could cause heteroscedasticity problems. If necessary, make transformations. In this case, <strong>the data seems OK</strong>.</p>
<hr />
</div>
<div id="check-collinearity" class="section level3 unnumbered">
<h3>Check collinearity</h3>
<p><strong>Check for collinearity between your explanatory variables</strong></p>
<p>The problem with collinear predictors is simply that they explain the same thing, so their effect on the response variable will be confounded in the model.</p>
<p>In this example, there is no risk of collinearity with only one continuous variable. If you had another continuous variable (<code>var2</code>), one simple way to check for collinearity is <code>cor(var1, var2)</code></p>
<p>Here an <a href="https://yetanotheriteration.netlify.app/2018/01/high-collinearity-effect-in-regressions/">example of collinearity</a>.</p>
<hr />
</div>
<div id="challenge-3" class="section level3 unnumbered">
<h3>Challenge 3</h3>
<p>This is a thinking problem!</p>
<p>Given our data, What additional measures could we have taken in the field that could have been strongly correlated with body length?</p>
<div id="challenge-3-solution" class="section level4 unnumbered">
<h4><strong>Challenge 3 Solution:</strong></h4>
<p>There are multiple potential answers here.</p>
<p>One example is fish body mass - this variable is strongly correlated with fish length. Therefore, we do not want to include these two variables in the same model.</p>
<hr />
</div>
</div>
<div id="consider-scale" class="section level3 unnumbered">
<h3>Consider scale</h3>
<p><strong>Consider the scale of your data</strong></p>
<p>If two variables in the same model have very different scales, the mixed model will likely return a <code>convergence error</code> when trying to compute the parameters.</p>
<p>The <a href="https://fr.wikipedia.org/wiki/Cote_Z_(statistiques)">Z-correction</a> standardizes the variables and solve this problem (use function <code>scale()</code> in <code>R</code>):</p>
<p><span class="math display">\[z = \frac{x-mean(x)}{standard.deviation(x)}\]</span>
Consider the scale of the variables within our dataset:</p>
<p>Body length -&gt; Long scale
Trophic position -&gt; Short scale</p>
<p>Because our data have very different scales of variation, we apply the <strong>Z-correction</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="mixed-model-protocol.html#cb11-1"></a><span class="co"># Standardized length, &#39;by hand&#39;</span></span>
<span id="cb11-2"><a href="mixed-model-protocol.html#cb11-2"></a>fish.data<span class="op">$</span>Z_Length &lt;-<span class="st"> </span>(fish.data<span class="op">$</span>Fish_Length <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(fish.data<span class="op">$</span>Fish_Length))<span class="op">/</span><span class="kw">sd</span>(fish.data<span class="op">$</span>Fish_Length)</span>
<span id="cb11-3"><a href="mixed-model-protocol.html#cb11-3"></a></span>
<span id="cb11-4"><a href="mixed-model-protocol.html#cb11-4"></a><span class="co"># Standardized trophic position, with the function scale</span></span>
<span id="cb11-5"><a href="mixed-model-protocol.html#cb11-5"></a>fish.data<span class="op">$</span>Z_TP &lt;-<span class="st"> </span><span class="kw">scale</span>(fish.data<span class="op">$</span>Trophic_Pos)</span></code></pre></div>
<hr />
</div>
<div id="do-you-need-a-lmm" class="section level3 unnumbered">
<h3>Do you need a LMM?</h3>
<p><strong>Determine if you need a mixed model</strong></p>
<p>To find out if a mixed model is needed for your data, you need to determine whether it is important to consider the random effects that might influence the relationship you are interested in (in our case, lake and species).</p>
<p>We can do this by:</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>Creating a linear model without random effect</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Calculating the residuals of this linear model</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>Plot the residuals against the levels of the potential random factors</li>
</ol></li>
</ul>
<p>Create a linear model without random effects</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="mixed-model-protocol.html#cb12-1"></a>lm.test &lt;-<span class="st"> </span><span class="kw">lm</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length, <span class="dt">data =</span> fish.data)</span></code></pre></div>
<p>Calculate residuals of this linear model</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="mixed-model-protocol.html#cb13-1"></a>lm.test.resid &lt;-<span class="st"> </span><span class="kw">rstandard</span>(lm.test)</span></code></pre></div>
<p>Plot the residuals against the levels of the potential random factors</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="mixed-model-protocol.html#cb14-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb14-2"><a href="mixed-model-protocol.html#cb14-2"></a></span>
<span id="cb14-3"><a href="mixed-model-protocol.html#cb14-3"></a><span class="kw">plot</span>(lm.test.resid <span class="op">~</span><span class="st"> </span><span class="kw">as.factor</span>(fish.data<span class="op">$</span>Fish_Species), <span class="dt">xlab =</span> <span class="st">&quot;Species&quot;</span>, </span>
<span id="cb14-4"><a href="mixed-model-protocol.html#cb14-4"></a>    <span class="dt">ylab =</span> <span class="st">&quot;Standardized residuals&quot;</span>)</span>
<span id="cb14-5"><a href="mixed-model-protocol.html#cb14-5"></a></span>
<span id="cb14-6"><a href="mixed-model-protocol.html#cb14-6"></a><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb14-7"><a href="mixed-model-protocol.html#cb14-7"></a></span>
<span id="cb14-8"><a href="mixed-model-protocol.html#cb14-8"></a><span class="kw">plot</span>(lm.test.resid <span class="op">~</span><span class="st"> </span><span class="kw">as.factor</span>(fish.data<span class="op">$</span>Lake), <span class="dt">xlab =</span> <span class="st">&quot;Lake&quot;</span>, </span>
<span id="cb14-9"><a href="mixed-model-protocol.html#cb14-9"></a>    <span class="dt">ylab =</span> <span class="st">&quot;Standardized residuals&quot;</span>)</span>
<span id="cb14-10"><a href="mixed-model-protocol.html#cb14-10"></a></span>
<span id="cb14-11"><a href="mixed-model-protocol.html#cb14-11"></a><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>These results suggest that there is residual variance that could be explained by these factors, so they should be included in a mixed effect model!</p>
</div>
</div>
<div id="step-2.-code-potential-models-and-model-selection" class="section level2 unnumbered">
<h2>Step 2. Code potential models and model selection</h2>
<div id="linley-stopped-here-2021-03-17" class="section level17">
<p class="heading"><span class="header-section-number">8.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.1</span> LINLEY STOPPED HERE 2021-03-17</p>
<p><strong>Translate this model…</strong></p>
<p><span class="math display">\[PT_{ijk} \sim Length_i + Lake_j + Species_k + \epsilon_{ijk}\]</span></p>
<p><strong>… in R code</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="mixed-model-protocol.html#cb15-1"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb15-2"><a href="mixed-model-protocol.html#cb15-2"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Z_TP ~ Z_Length + (1 | Lake) + (1 | Fish_Species)
##    Data: fish.data
## REML criterion at convergence: 72.4662
## Random effects:
##  Groups       Name        Std.Dev.
##  Lake         (Intercept) 0.4516  
##  Fish_Species (Intercept) 0.9301  
##  Residual                 0.2605  
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## Fixed Effects:
## (Intercept)     Z_Length  
##   9.752e-14    4.198e-01</code></pre>
<p>–</p>
<ul>
<li><code>lmer</code> <img src="arrow-right" alt=":faic" />“linear mixed model” function from <code>lme4</code> package</li>
<li><code>(1 | Lake)</code> <img src="arrow-right" alt=":faic" /> indicate varying intercepts among lakes</li>
<li><code>REML = TRUE</code> <img src="arrow-right" alt=":faic" /> estimation method</li>
</ul>
</div>
</div>
</div>
<hr>
<center> 
  <div class="footer">
      All the content of the workshop series is under a <a href="https://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="how-do-lmms-work.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="note-on-estimation-methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
