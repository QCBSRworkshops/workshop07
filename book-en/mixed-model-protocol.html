<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Mixed model protocol | Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)</title>
  <meta name="description" content="Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Mixed model protocol | Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/qcbsRworkshops/" />
  <meta property="og:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />
  <meta property="og:description" content="Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta name="github-repo" content="qcbsRworkshops/workshop09" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Mixed model protocol | Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)" />
  
  <meta name="twitter:description" content="Linear and generalized linear mixed models (LMM and GLMM)" />
  <meta name="twitter:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />

<meta name="author" content="Developed and maintained by the contributors of the QCBS R Workshop Series" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="how-do-lmms-work.html"/>
<link rel="next" href="generalized-linear-mixed-models-glmms.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/qcbs-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/images/csbq_logo_gray_accueil.png"></a></li>
<link rel="icon" type="image/png" href="assets/images/favicon.ico"/>

<li class="divider"></li>
<li class="part"><span><b>QCBS R Workshop Series</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1</b> Code of conduct</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#expected-behaviour"><i class="fa fa-check"></i><b>0.1.1</b> Expected behaviour</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#unacceptable-behaviour"><i class="fa fa-check"></i><b>0.1.2</b> Unacceptable behaviour</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>0.2</b> Contributors</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#contributing"><i class="fa fa-check"></i><b>0.3</b> Contributing</a></li>
</ul></li>
<li class="part"><span><b>Linear mixed models (LMM) in <code>R</code></b></span></li>
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning objectives</a></li>
<li class="chapter" data-level="2" data-path="preparing-for-the-workshop.html"><a href="preparing-for-the-workshop.html"><i class="fa fa-check"></i><b>2</b> Preparing for the workshop</a></li>
<li class="chapter" data-level="3" data-path="why-choose-mixed-models.html"><a href="why-choose-mixed-models.html"><i class="fa fa-check"></i><b>3</b> Why choose mixed models?</a></li>
<li class="chapter" data-level="4" data-path="starting-with-a-question.html"><a href="starting-with-a-question.html"><i class="fa fa-check"></i><b>4</b> Starting with a question</a><ul>
<li class="chapter" data-level="4.1" data-path="starting-with-a-question.html"><a href="starting-with-a-question.html#challenge-1"><i class="fa fa-check"></i><b>4.1</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html"><i class="fa fa-check"></i><b>5</b> Analyzing the data</a><ul>
<li class="chapter" data-level="5.1" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html#separate"><i class="fa fa-check"></i><b>5.1</b> Separate</a></li>
<li class="chapter" data-level="5.2" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html#lump"><i class="fa fa-check"></i><b>5.2</b> Lump</a></li>
<li class="chapter" data-level="5.3" data-path="analyzing-the-data.html"><a href="analyzing-the-data.html#is-there-a-third-option"><i class="fa fa-check"></i><b>5.3</b> Is there a third option?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="fixed-vs-random-effects.html"><a href="fixed-vs-random-effects.html"><i class="fa fa-check"></i><b>6</b> Fixed vs. random effects</a><ul>
<li class="chapter" data-level="6.1" data-path="fixed-vs-random-effects.html"><a href="fixed-vs-random-effects.html#fixed-effects-deterministic-processes"><i class="fa fa-check"></i><b>6.1</b> Fixed effects: deterministic processes</a></li>
<li class="chapter" data-level="6.2" data-path="fixed-vs-random-effects.html"><a href="fixed-vs-random-effects.html#random-effects-stochastic-processes"><i class="fa fa-check"></i><b>6.2</b> Random effects: stochastic processes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html"><i class="fa fa-check"></i><b>7</b> How do LMMs work?</a><ul>
<li class="chapter" data-level="7.1" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#parameters-are-varied"><i class="fa fa-check"></i><b>7.1</b> Parameters are varied</a><ul>
<li class="chapter" data-level="" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#intercepts"><i class="fa fa-check"></i>Intercepts:</a></li>
<li class="chapter" data-level="" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#slopes"><i class="fa fa-check"></i>Slopes:</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#data-structure-is-taken-into-account"><i class="fa fa-check"></i><b>7.2</b> Data structure is taken into account</a></li>
<li class="chapter" data-level="7.3" data-path="how-do-lmms-work.html"><a href="how-do-lmms-work.html#challenge-2"><i class="fa fa-check"></i><b>7.3</b> Challenge 2</a></li>
</ul></li>
<li class="part"><span><b>Implementing LMM in <code>R</code></b></span></li>
<li class="chapter" data-level="8" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html"><i class="fa fa-check"></i><b>8</b> Mixed model protocol</a><ul>
<li><a href="mixed-model-protocol.html#step-1.-a-priori-model-building">Step 1. <em>A priori</em> model building</a><ul>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#check-data-structure"><i class="fa fa-check"></i>Check data structure</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#check-collinearity"><i class="fa fa-check"></i>Check collinearity</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#challenge-3"><i class="fa fa-check"></i>Challenge 3</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#consider-scale"><i class="fa fa-check"></i>Consider scale</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#do-you-need-a-lmm"><i class="fa fa-check"></i>Do you need a LMM?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#step-2.-code-potential-models-and-model-selection"><i class="fa fa-check"></i>Step 2. Code potential models and model selection</a><ul>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#estimation-methods"><i class="fa fa-check"></i>Estimation methods</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#different-model-structures"><i class="fa fa-check"></i>Different model structures</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#challenge-4"><i class="fa fa-check"></i>Challenge 4</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#challenge-5"><i class="fa fa-check"></i>Challenge 5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#step-3.-model-validation"><i class="fa fa-check"></i>Step 3. Model validation</a><ul>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#check-the-homogeneity-of-the-variance"><i class="fa fa-check"></i>1. Check the homogeneity of the variance</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#check-the-independence-of-the-model-residuals-with-each-covariate"><i class="fa fa-check"></i>2. Check the independence of the model residuals with each covariate</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#check-the-normality-of-the-model-residuals"><i class="fa fa-check"></i>3. Check the normality of the model residuals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#step-4.-interpretation-and-visualization"><i class="fa fa-check"></i>Step 4. Interpretation and visualization</a><ul>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#challenge-6"><i class="fa fa-check"></i>Challenge 6</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#challenge-7"><i class="fa fa-check"></i>Challenge 7</a></li>
<li class="chapter" data-level="" data-path="mixed-model-protocol.html"><a href="mixed-model-protocol.html#challenge-8"><i class="fa fa-check"></i>Challenge 8</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Generalized linear mixed models (GLMM) in <code>R</code></b></span></li>
<li class="chapter" data-level="9" data-path="generalized-linear-mixed-models-glmms.html"><a href="generalized-linear-mixed-models-glmms.html"><i class="fa fa-check"></i><b>9</b> Generalized linear mixed models (GLMMs)</a></li>
<li class="chapter" data-level="10" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html"><i class="fa fa-check"></i><b>10</b> Structure in dataset</a><ul>
<li class="chapter" data-level="10.1" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html#poisson-glmm"><i class="fa fa-check"></i><b>10.1</b> Poisson GLMM</a></li>
<li class="chapter" data-level="10.2" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html#negative-binomial-poisson-gamma-glmm"><i class="fa fa-check"></i><b>10.2</b> Negative binomial (Poisson-gamma) GLMM</a></li>
<li class="chapter" data-level="10.3" data-path="structure-in-dataset.html"><a href="structure-in-dataset.html#poisson-lognormal-glmm"><i class="fa fa-check"></i><b>10.3</b> Poisson-lognormal GLMM</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="random-intercepts.html"><a href="random-intercepts.html"><i class="fa fa-check"></i><b>11</b> Random intercepts</a><ul>
<li class="chapter" data-level="11.1" data-path="random-intercepts.html"><a href="random-intercepts.html#parameter-plots"><i class="fa fa-check"></i><b>11.1</b> Parameter plots</a></li>
<li class="chapter" data-level="11.2" data-path="random-intercepts.html"><a href="random-intercepts.html#random-intercept-plots"><i class="fa fa-check"></i><b>11.2</b> Random intercept plots</a></li>
<li class="chapter" data-level="11.3" data-path="random-intercepts.html"><a href="random-intercepts.html#random-slopes"><i class="fa fa-check"></i><b>11.3</b> Random slopes</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="final-model.html"><a href="final-model.html"><i class="fa fa-check"></i><b>12</b> Final model</a></li>
<li class="part"><span><b>Final considerations</b></span></li>
<li class="chapter" data-level="13" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>13</b> Summary</a></li>
<li class="chapter" data-level="14" data-path="additional-resources.html"><a href="additional-resources.html"><i class="fa fa-check"></i><b>14</b> Additional resources</a><ul>
<li class="chapter" data-level="14.1" data-path="additional-resources.html"><a href="additional-resources.html#lmm-textbooks"><i class="fa fa-check"></i><b>14.1</b> LMM Textbooks</a></li>
<li class="chapter" data-level="14.2" data-path="additional-resources.html"><a href="additional-resources.html#glmm-resources"><i class="fa fa-check"></i><b>14.2</b> GLMM resources</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>15</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/qcbsRworkshops" target="blank">QCBS R Workshop Series</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop 7: Linear and generalized linear mixed models (LMM and GLMM)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!------------------------ Hero Image Container --------------------------> 

<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <script src="https://kit.fontawesome.com/6a26f47516.js"></script>
  <script src="assets/qcbs-hideOutput.js"></script>
  <link href="assets/qcbs-style.css" rel="stylesheet">
</head>



<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/images/jean-philippe-delberghe-75xPHEQBmvA-unsplash_hero_image.jpg">
</div>
<div id="mixed-model-protocol" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Mixed model protocol</h1>
<ul>
<li><strong>Step 1.</strong> <em>A priori</em> model building and data exploration</li>
<li><strong>Step 2.</strong> Code potential models and model selection</li>
<li><strong>Step 3.</strong> Model validation</li>
<li><strong>Step 4.</strong> Model interpretation and visualization</li>
</ul>
<div id="step-1.-a-priori-model-building" class="section level2 unnumbered">
<h2>Step 1. <em>A priori</em> model building</h2>
<p><strong>What we know <em>a priori</em>:</strong></p>
<p>We want to determine if the trophic position can be predicted by body length, while taking into account the variation between species and lakes. So we want a model that looks like this:</p>
<p><span class="math display">\[PT_{ijk} \sim Length_i + Lake_j + Species_k + \epsilon_{ijk}\]</span></p>
<div id="check-data-structure" class="section level3 unnumbered">
<h3>Check data structure</h3>
<p><strong>Does the data have the right structure?</strong></p>
<p>Look at the data structure:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="mixed-model-protocol.html#cb6-1"></a><span class="co"># Look at data structure</span></span>
<span id="cb6-2"><a href="mixed-model-protocol.html#cb6-2"></a><span class="kw">str</span>(fish.data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    180 obs. of  4 variables:
##  $ Lake        : chr  &quot;L1&quot; &quot;L1&quot; &quot;L1&quot; &quot;L1&quot; ...
##  $ Fish_Species: chr  &quot;S1&quot; &quot;S1&quot; &quot;S1&quot; &quot;S1&quot; ...
##  $ Fish_Length : num  105 195 294 414 237 ...
##  $ Trophic_Pos : num  2.6 2.7 2.74 2.74 2.79 ...</code></pre>
<p>Now look at the distribution of samples for each factor:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="mixed-model-protocol.html#cb8-1"></a><span class="co"># Look at the distribution of samples for each factor</span></span>
<span id="cb8-2"><a href="mixed-model-protocol.html#cb8-2"></a><span class="kw">table</span>(fish.data[, <span class="kw">c</span>(<span class="st">&quot;Lake&quot;</span>, <span class="st">&quot;Fish_Species&quot;</span>)])</span></code></pre></div>
<pre><code>##     Fish_Species
## Lake S1 S2 S3
##   L1 10 10 10
##   L2 10 10 10
##   L3 10 10 10
##   L4 10 10 10
##   L5 10 10 10
##   L6 10 10 10</code></pre>
<p>This dataset is perfectly balanced, but <strong>mixed models can be used to analyze unbalanced experimental plans</strong>, as it is often the case in ecology!</p>
<p>Let’s also look at the distribution of continuous variables:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="mixed-model-protocol.html#cb10-1"></a><span class="co"># Look at the distribution of continuous variables:</span></span>
<span id="cb10-2"><a href="mixed-model-protocol.html#cb10-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb10-3"><a href="mixed-model-protocol.html#cb10-3"></a><span class="kw">hist</span>(fish.data<span class="op">$</span>Fish_Length, <span class="dt">xlab =</span> <span class="st">&quot;Length (mm)&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb10-4"><a href="mixed-model-protocol.html#cb10-4"></a><span class="kw">hist</span>(fish.data<span class="op">$</span>Trophic_Pos, <span class="dt">xlab =</span> <span class="st">&quot;Trophic position&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Major deviations could cause heteroscedasticity problems. If necessary, make transformations. In this case, <strong>the data seems OK</strong>.</p>
<hr />
</div>
<div id="check-collinearity" class="section level3 unnumbered">
<h3>Check collinearity</h3>
<p><strong>Check for collinearity between your explanatory variables</strong></p>
<p>The problem with collinear predictors is simply that they explain the same thing, so their effect on the response variable will be confounded in the model.</p>
<p>In this example, there is no risk of collinearity with only one continuous variable. If you had another continuous variable (<code>var2</code>), one simple way to check for collinearity is <code>cor(var1, var2)</code></p>
<p>Here an <a href="https://yetanotheriteration.netlify.app/2018/01/high-collinearity-effect-in-regressions/">example of collinearity</a>.</p>
<hr />
</div>
<div id="challenge-3" class="section level3 unnumbered">
<h3>Challenge 3</h3>
<p>This is a thinking problem!</p>
<p>Given our data, What additional measures could we have taken in the field that could have been strongly correlated with body length?</p>
<hr />
<div id="challenge-3-solution" class="section level4 unnumbered">
<h4><strong>Challenge 3 Solution:</strong></h4>
<p>There are multiple potential answers here.</p>
<p>One example is fish body mass - this variable is strongly correlated with fish length. Therefore, we do not want to include these two variables in the same model.</p>
<hr />
</div>
</div>
<div id="consider-scale" class="section level3 unnumbered">
<h3>Consider scale</h3>
<p><strong>Consider the scale of your data</strong></p>
<p>If two variables in the same model have very different scales, the mixed model will likely return a <code>convergence error</code> when trying to compute the parameters.</p>
<p>The <a href="https://fr.wikipedia.org/wiki/Cote_Z_(statistiques)">Z-correction</a> standardizes the variables and solve this problem (use function <code>scale()</code> in <code>R</code>):</p>
<p><span class="math display">\[z = \frac{x-mean(x)}{standard.deviation(x)}\]</span>
Consider the scale of the variables within our dataset:</p>
<p>Body length -&gt; Long scale
Trophic position -&gt; Short scale</p>
<p>Because our data have very different scales of variation, we apply the <strong>Z-correction</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="mixed-model-protocol.html#cb11-1"></a><span class="co"># Standardized length, &#39;by hand&#39;</span></span>
<span id="cb11-2"><a href="mixed-model-protocol.html#cb11-2"></a>fish.data<span class="op">$</span>Z_Length &lt;-<span class="st"> </span>(fish.data<span class="op">$</span>Fish_Length <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(fish.data<span class="op">$</span>Fish_Length))<span class="op">/</span><span class="kw">sd</span>(fish.data<span class="op">$</span>Fish_Length)</span>
<span id="cb11-3"><a href="mixed-model-protocol.html#cb11-3"></a></span>
<span id="cb11-4"><a href="mixed-model-protocol.html#cb11-4"></a><span class="co"># Standardized trophic position, with the function scale</span></span>
<span id="cb11-5"><a href="mixed-model-protocol.html#cb11-5"></a>fish.data<span class="op">$</span>Z_TP &lt;-<span class="st"> </span><span class="kw">scale</span>(fish.data<span class="op">$</span>Trophic_Pos)</span></code></pre></div>
<hr />
</div>
<div id="do-you-need-a-lmm" class="section level3 unnumbered">
<h3>Do you need a LMM?</h3>
<p><strong>Determine if you need a mixed model</strong></p>
<p>To find out if a mixed model is needed for your data, you need to determine whether it is important to consider the random effects that might influence the relationship you are interested in (in our case, lake and species).</p>
<p>We can do this by:</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>Creating a linear model without random effect</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Calculating the residuals of this linear model</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>Plot the residuals against the levels of the potential random factors</li>
</ol></li>
</ul>
<p>Create a linear model without random effects</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="mixed-model-protocol.html#cb12-1"></a>lm.test &lt;-<span class="st"> </span><span class="kw">lm</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length, <span class="dt">data =</span> fish.data)</span></code></pre></div>
<p>Calculate residuals of this linear model</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="mixed-model-protocol.html#cb13-1"></a>lm.test.resid &lt;-<span class="st"> </span><span class="kw">rstandard</span>(lm.test)</span></code></pre></div>
<p>Plot the residuals against the levels of the potential random factors</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="mixed-model-protocol.html#cb14-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb14-2"><a href="mixed-model-protocol.html#cb14-2"></a></span>
<span id="cb14-3"><a href="mixed-model-protocol.html#cb14-3"></a><span class="kw">plot</span>(lm.test.resid <span class="op">~</span><span class="st"> </span><span class="kw">as.factor</span>(fish.data<span class="op">$</span>Fish_Species), <span class="dt">xlab =</span> <span class="st">&quot;Species&quot;</span>, </span>
<span id="cb14-4"><a href="mixed-model-protocol.html#cb14-4"></a>    <span class="dt">ylab =</span> <span class="st">&quot;Standardized residuals&quot;</span>)</span>
<span id="cb14-5"><a href="mixed-model-protocol.html#cb14-5"></a></span>
<span id="cb14-6"><a href="mixed-model-protocol.html#cb14-6"></a><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb14-7"><a href="mixed-model-protocol.html#cb14-7"></a></span>
<span id="cb14-8"><a href="mixed-model-protocol.html#cb14-8"></a><span class="kw">plot</span>(lm.test.resid <span class="op">~</span><span class="st"> </span><span class="kw">as.factor</span>(fish.data<span class="op">$</span>Lake), <span class="dt">xlab =</span> <span class="st">&quot;Lake&quot;</span>, </span>
<span id="cb14-9"><a href="mixed-model-protocol.html#cb14-9"></a>    <span class="dt">ylab =</span> <span class="st">&quot;Standardized residuals&quot;</span>)</span>
<span id="cb14-10"><a href="mixed-model-protocol.html#cb14-10"></a></span>
<span id="cb14-11"><a href="mixed-model-protocol.html#cb14-11"></a><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>These results suggest that there is residual variance that could be explained by these factors, so they should be included in a mixed effect model!</p>
</div>
</div>
<div id="step-2.-code-potential-models-and-model-selection" class="section level2 unnumbered">
<h2>Step 2. Code potential models and model selection</h2>
<p><strong>Translate this model…</strong></p>
<p><span class="math display">\[PT_{ijk} \sim Length_i + Lake_j + Species_k + \epsilon_{ijk}\]</span></p>
<p><strong>… into R code</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="mixed-model-protocol.html#cb15-1"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb15-2"><a href="mixed-model-protocol.html#cb15-2"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Z_TP ~ Z_Length + (1 | Lake) + (1 | Fish_Species)
##    Data: fish.data
## REML criterion at convergence: 72.4662
## Random effects:
##  Groups       Name        Std.Dev.
##  Lake         (Intercept) 0.4516  
##  Fish_Species (Intercept) 0.9301  
##  Residual                 0.2605  
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## Fixed Effects:
## (Intercept)     Z_Length  
##   9.752e-14    4.198e-01</code></pre>
<p>Where:</p>
<ul>
<li><code>lmer</code> -&gt; “linear mixed model” function from <code>lme4</code> package</li>
<li><code>(1 | Lake)</code> -&gt; indicate varying intercepts among lakes</li>
<li><code>REML = TRUE</code> -&gt; estimation method</li>
</ul>
<div id="estimation-methods" class="section level3 unnumbered">
<h3>Estimation methods</h3>
<p>REML (<em>Restricted Maximum Likelihood</em>) is the default method in <code>lmer</code> (see <code>?lmer</code>).</p>
<p>The <em>Maximum Likelihood</em> (ML) method underestimate model variances by a factor of <span class="math inline">\((n-k)/n\)</span>, where <span class="math inline">\(k\)</span> is the number of fixed effects. The <em>REML</em> method corrects for this bias.</p>
<p>REML estimates can be used when comparing models with the same fixed effects (i.e. nested models). However, if you are comparing models where the fixed effects differ among models then maximum likelihood should be used to fit parameters as this method is not dependent on the coefficients of the fixed effects. Fitting using maximum likelihood is done by setting <code>REML=FALSE</code> in the lmer command.</p>
<p>See this <a href="https://towardsdatascience.com/maximum-likelihood-ml-vs-reml-78cf79bef2cf">article</a> for more information on the difference between ML and REML.</p>
<p><strong>In summary:</strong></p>
<ul>
<li><p><strong>REML</strong> to compare models with <strong>nested random effects</strong> and the same fixed effect structure</p></li>
<li><p><strong>ML</strong> to compare models with <strong>nested fixed effects</strong> and the same random effect structure</p></li>
<li><p><strong>ML</strong> to compare models <strong>with and without random effects</strong></p></li>
</ul>
</div>
<div id="different-model-structures" class="section level3 unnumbered">
<h3>Different model structures</h3>
<p><strong>What if we want the slopes to vary?</strong></p>
<p><img src="images/fig_22_w5.png" /></p>
<p><strong>Let’s look at different model structures:</strong></p>
<ul>
<li><p><code>(1 | Lake)</code> random effect by lake at the intrecept</p></li>
<li><p><code>(1 + Z_Length | Lake)</code> random effect by lake at the intercept and slope in response to the body length (NB: (<code>Z_Length | Lake)</code> gives the same random structure)</p></li>
<li><p><code>(-1 + Z_Length | Lake)</code> to have only the random effect at the slope</p></li>
<li><p><code>(1 | Lake) + (1 | Species)</code> for crossed random effects</p></li>
<li><p><code>(1 | Lake:Fish_Species)</code> for the interaction between 2 random effects</p></li>
<li><p>If your dataset includes nested random effects, you could use <code>/</code> to specify them, e.g. <code>(1 | factor1 / factor2)</code> if <code>factor2</code> is nested in <code>factor1</code> (<a href="https://stats.stackexchange.com/questions/228800/crossed-vs-nested-random-effects-how-do-they-differ-and-how-are-they-specified">see <img src="stack-exchange" alt=":faic" /></a>)</p></li>
</ul>
</div>
<div id="challenge-4" class="section level3 unnumbered">
<h3>Challenge 4</h3>
<p>Re-write the following code so that the <strong>slopes</strong> of the relationship between trophic position and body length <strong>vary by lake and species</strong>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="mixed-model-protocol.html#cb17-1"></a><span class="co"># Challenge 4: Can you re-write this code so that the slopes</span></span>
<span id="cb17-2"><a href="mixed-model-protocol.html#cb17-2"></a><span class="co"># between trophic position and body length vary by lake and</span></span>
<span id="cb17-3"><a href="mixed-model-protocol.html#cb17-3"></a><span class="co"># species?</span></span>
<span id="cb17-4"><a href="mixed-model-protocol.html#cb17-4"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb17-5"><a href="mixed-model-protocol.html#cb17-5"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Z_TP ~ Z_Length + (1 | Lake) + (1 | Fish_Species)
##    Data: fish.data
## REML criterion at convergence: 72.4662
## Random effects:
##  Groups       Name        Std.Dev.
##  Lake         (Intercept) 0.4516  
##  Fish_Species (Intercept) 0.9301  
##  Residual                 0.2605  
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## Fixed Effects:
## (Intercept)     Z_Length  
##   9.752e-14    4.198e-01</code></pre>
<hr />
<div id="challenge-4-solution" class="section level4 unnumbered">
<h4><strong>Challenge 4 Solution:</strong></h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="mixed-model-protocol.html#cb19-1"></a><span class="co"># Challenge 4 solution:</span></span>
<span id="cb19-2"><a href="mixed-model-protocol.html#cb19-2"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span></span>
<span id="cb19-3"><a href="mixed-model-protocol.html#cb19-3"></a><span class="st">    </span>Fish_Species), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: 
## Z_TP ~ Z_Length + (1 + Z_Length | Lake) + (1 + Z_Length | Fish_Species)
##    Data: fish.data
## REML criterion at convergence: 20.5786
## Random effects:
##  Groups       Name        Std.Dev. Corr 
##  Lake         (Intercept) 0.45279       
##               Z_Length    0.02378  -0.82
##  Fish_Species (Intercept) 0.93103       
##               Z_Length    0.15728  1.00 
##  Residual                 0.22341       
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## Fixed Effects:
## (Intercept)     Z_Length  
##  -0.0009025    0.4223738  
## optimizer (nloptwrap) convergence code: 0 (OK) ; 0 optimizer warnings; 1 lme4 warnings</code></pre>
<hr />
</div>
</div>
<div id="challenge-5" class="section level3 unnumbered">
<h3>Challenge 5</h3>
<p>To determine if you have built the best mixed model based on your prior knowledge, you should compare this <em>a priori</em> model to other alternative models.</p>
<p>With the dataset you are working on, there are several alternative models that might better fit your data. For challenge 5, make a list of 7 alternative models that could be compared to this one:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="mixed-model-protocol.html#cb22-1"></a><span class="co"># Challenge 5: Make a list of 7 alternative models that could</span></span>
<span id="cb22-2"><a href="mixed-model-protocol.html#cb22-2"></a><span class="co"># be compared to this initial model:</span></span>
<span id="cb22-3"><a href="mixed-model-protocol.html#cb22-3"></a><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb22-4"><a href="mixed-model-protocol.html#cb22-4"></a>    <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Z_TP ~ Z_Length + (1 | Lake) + (1 | Fish_Species)
##    Data: fish.data
## REML criterion at convergence: 72.4662
## Random effects:
##  Groups       Name        Std.Dev.
##  Lake         (Intercept) 0.4516  
##  Fish_Species (Intercept) 0.9301  
##  Residual                 0.2605  
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## Fixed Effects:
## (Intercept)     Z_Length  
##   9.752e-14    4.198e-01</code></pre>
<p><em>Note: If we had different fixed effects between the models or a model without random effects, we would have to specify <code>REML = FALSE</code> to compare with likelihood methods like AIC.</em></p>
<hr />
<div id="challenge-5-solution" class="section level4 unnumbered">
<h4><strong>Challenge 5 Solution:</strong></h4>
<p>We first will also build the <strong>basic linear model</strong> <code>lm()</code> because it is always useful to see the variation in the AICc values (we will discuss these in more detail in the next section).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="mixed-model-protocol.html#cb24-1"></a><span class="co"># Challenge 5 solution: Basic linear model</span></span>
<span id="cb24-2"><a href="mixed-model-protocol.html#cb24-2"></a>M0 &lt;-<span class="st"> </span><span class="kw">lm</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length, <span class="dt">data =</span> fish.data)</span></code></pre></div>
<p>In order to compare this model to the LMMs, it is important to <strong>change the estimation method to ML (<code>REML=FALSE</code>)</strong> for all other models because <code>lm()</code> does not use the same estimation method as <code>lmer()</code>.</p>
<p>Let’s look at the other models you could have written (note <code>REML = FALSE</code>):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="mixed-model-protocol.html#cb25-1"></a><span class="co"># Challenge 5 solution, other potential models Note that REML</span></span>
<span id="cb25-2"><a href="mixed-model-protocol.html#cb25-2"></a><span class="co"># = FALSE in order to compare with the basic linear model</span></span>
<span id="cb25-3"><a href="mixed-model-protocol.html#cb25-3"></a><span class="co"># where estimation method = ML</span></span>
<span id="cb25-4"><a href="mixed-model-protocol.html#cb25-4"></a></span>
<span id="cb25-5"><a href="mixed-model-protocol.html#cb25-5"></a><span class="co"># Basic linear model / Linear model with no random effects</span></span>
<span id="cb25-6"><a href="mixed-model-protocol.html#cb25-6"></a>M0 &lt;-<span class="st"> </span><span class="kw">lm</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length, <span class="dt">data =</span> fish.data)</span>
<span id="cb25-7"><a href="mixed-model-protocol.html#cb25-7"></a><span class="co"># Full model with varying intercepts</span></span>
<span id="cb25-8"><a href="mixed-model-protocol.html#cb25-8"></a>M1 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), </span>
<span id="cb25-9"><a href="mixed-model-protocol.html#cb25-9"></a>    <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb25-10"><a href="mixed-model-protocol.html#cb25-10"></a><span class="co"># Full model with varying intercepts and slopes</span></span>
<span id="cb25-11"><a href="mixed-model-protocol.html#cb25-11"></a>M2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-12"><a href="mixed-model-protocol.html#cb25-12"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="mixed-model-protocol.html#cb27-1"></a><span class="co"># No Lake, varying intercepts only</span></span>
<span id="cb27-2"><a href="mixed-model-protocol.html#cb27-2"></a>M3 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb27-3"><a href="mixed-model-protocol.html#cb27-3"></a>    <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb27-4"><a href="mixed-model-protocol.html#cb27-4"></a><span class="co"># No Species, varying intercepts only</span></span>
<span id="cb27-5"><a href="mixed-model-protocol.html#cb27-5"></a>M4 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span>
<span id="cb27-6"><a href="mixed-model-protocol.html#cb27-6"></a><span class="co"># No Lake, varying intercepts and slopes</span></span>
<span id="cb27-7"><a href="mixed-model-protocol.html#cb27-7"></a>M5 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species), <span class="dt">data =</span> fish.data, </span>
<span id="cb27-8"><a href="mixed-model-protocol.html#cb27-8"></a>    <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="mixed-model-protocol.html#cb29-1"></a><span class="co"># No Species, varying intercepts and slopes</span></span>
<span id="cb29-2"><a href="mixed-model-protocol.html#cb29-2"></a>M6 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, </span>
<span id="cb29-3"><a href="mixed-model-protocol.html#cb29-3"></a>    <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="mixed-model-protocol.html#cb31-1"></a><span class="co"># Full model with varying intercepts and slopes only varying</span></span>
<span id="cb31-2"><a href="mixed-model-protocol.html#cb31-2"></a><span class="co"># by lake</span></span>
<span id="cb31-3"><a href="mixed-model-protocol.html#cb31-3"></a>M7 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span></span>
<span id="cb31-4"><a href="mixed-model-protocol.html#cb31-4"></a><span class="st">    </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="mixed-model-protocol.html#cb33-1"></a><span class="co"># Full model with varying intercepts and slopes only varying</span></span>
<span id="cb33-2"><a href="mixed-model-protocol.html#cb33-2"></a><span class="co"># by species</span></span>
<span id="cb33-3"><a href="mixed-model-protocol.html#cb33-3"></a>M8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb33-4"><a href="mixed-model-protocol.html#cb33-4"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<p><strong>When fitting LMMs with <code>lmer()</code>, you may encounter some errors or warnings such as:</strong></p>
<ul>
<li><p><code>boundary (singular) fit: see ?isSingular</code>, see <a href="https://stats.stackexchange.com/questions/378939/dealing-with-singular-fit-in-mixed-models">this discussion on stack-exchange</a></p></li>
<li><p><code>Model failed to converge with max|grad| ...</code>, see <a href="https://stats.stackexchange.com/questions/242109/model-failed-to-converge-warning-in-lmer">this discussion on stack-exchange</a></p></li>
</ul>
<p>Here a <a href="https://rdrr.io/cran/lme4/man/troubleshooting.html">list</a> of possible problems and how to troubleshoot them.</p>
<p><strong>What do these AICc values mean?</strong></p>
<ul>
<li>The model with the smallest AICc has the highest predictive power.</li>
<li>Some suggest that if models are within 2 AICc units of each other then they are equally plausible.</li>
<li>Let’s take a closer look at M8 and M2. We can exclude other models because they have such higher AICc.</li>
</ul>
<p><em>Note that we use now REML (i.e. <code>REML = TRUE</code>) as we are comparing two models with nested random effects and the same fixed effect structure.</em></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="mixed-model-protocol.html#cb35-1"></a><span class="co"># Let&#39;s take a closer look at M8 and M2. We can exclude other</span></span>
<span id="cb35-2"><a href="mixed-model-protocol.html#cb35-2"></a><span class="co"># model because they have such higher AICc Because we are</span></span>
<span id="cb35-3"><a href="mixed-model-protocol.html#cb35-3"></a><span class="co"># comparing two mixed effect models, we can set `REML = TRUE`</span></span>
<span id="cb35-4"><a href="mixed-model-protocol.html#cb35-4"></a><span class="co"># when generating M8 and M2</span></span>
<span id="cb35-5"><a href="mixed-model-protocol.html#cb35-5"></a>M8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-6"><a href="mixed-model-protocol.html#cb35-6"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="mixed-model-protocol.html#cb37-1"></a>M2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb37-2"><a href="mixed-model-protocol.html#cb37-2"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="mixed-model-protocol.html#cb39-1"></a><span class="co"># Now let&#39;s print a table in order to compare M2 and M8</span></span>
<span id="cb39-2"><a href="mixed-model-protocol.html#cb39-2"></a>MuMIn<span class="op">::</span><span class="kw">model.sel</span>(M2, M8)[, <span class="kw">c</span>(<span class="st">&quot;df&quot;</span>, <span class="st">&quot;logLik&quot;</span>, <span class="st">&quot;AICc&quot;</span>, <span class="st">&quot;delta&quot;</span>)]</span></code></pre></div>
<pre><code>##    df    logLik     AICc    delta
## M8  7 -10.84011 36.33137 0.000000
## M2  9 -10.28932 39.63747 3.306098</code></pre>
<p>Model <code>M8</code> seems to be the best among all models that we tested.</p>
<hr />
<p><strong>What is the structure of the best model?</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="mixed-model-protocol.html#cb41-1"></a><span class="co"># Let&#39;s take a look at the best model again, what is it&#39;s</span></span>
<span id="cb41-2"><a href="mixed-model-protocol.html#cb41-2"></a><span class="co"># structure?</span></span>
<span id="cb41-3"><a href="mixed-model-protocol.html#cb41-3"></a>M8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb41-4"><a href="mixed-model-protocol.html#cb41-4"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="mixed-model-protocol.html#cb43-1"></a><span class="co"># Both the intercepts and slopes of the relationship between</span></span>
<span id="cb43-2"><a href="mixed-model-protocol.html#cb43-2"></a><span class="co"># trophic position and length may vary by fish species, but</span></span>
<span id="cb43-3"><a href="mixed-model-protocol.html#cb43-3"></a><span class="co"># only the intercepts may vary by lake.</span></span></code></pre></div>
<p>Both the intercepts and slopes of the relationship between trophic position and length may vary by fish species, but only the intercepts may vary by lake.</p>
<div class="two-col">
<p><img src="images/fig_9_w5.png" /><br />
<img src="images/fig_8_w5.png" /></p>
</div>
<p>Once the best model is selected, the estimation method must be reset to <code>REML = TRUE</code>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="mixed-model-protocol.html#cb44-1"></a><span class="co"># Once the best model is selected, the estimation method must</span></span>
<span id="cb44-2"><a href="mixed-model-protocol.html#cb44-2"></a><span class="co"># be reset to `REML = TRUE`.</span></span>
<span id="cb44-3"><a href="mixed-model-protocol.html#cb44-3"></a>M8 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Z_TP <span class="op">~</span><span class="st"> </span>Z_Length <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z_Length <span class="op">|</span><span class="st"> </span>Fish_Species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-4"><a href="mixed-model-protocol.html#cb44-4"></a><span class="st">    </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Lake), <span class="dt">data =</span> fish.data, <span class="dt">REML =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
</div>
</div>
</div>
<div id="step-3.-model-validation" class="section level2 unnumbered">
<h2>Step 3. Model validation</h2>
<p>Now that we have our model, we must verify that the model follows all the basic assumptions:</p>
<ul>
<li><strong>1. Check the homogeneity of the variance:</strong>
<ul>
<li>Plot predicted values vs residual values</li>
</ul></li>
<li><strong>2. Check the independence of the model residuals:</strong>
<ul>
<li>Plot residuals vs each covariate of the model</li>
<li>Plot residuals vs each covariate not included in the model</li>
</ul></li>
<li><strong>3. Check the normality of the model residuals:</strong>
<ul>
<li>Histogram of residuals</li>
</ul></li>
</ul>
<div id="check-the-homogeneity-of-the-variance" class="section level3 unnumbered">
<h3>1. Check the homogeneity of the variance</h3>
<p>In order to check the homgeneity of the variance, we can plot predicted values vs residual values.</p>
<p>Homogeneous dispersion of the residuals means that the assumption is respected.</p>
<p><img src="images/resid-plots.gif" /></p>
<p>Now let’s look at our data, is the dispersion homogenous?</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="mixed-model-protocol.html#cb46-1"></a><span class="co"># Plot predicted values vs residual values</span></span>
<span id="cb46-2"><a href="mixed-model-protocol.html#cb46-2"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb46-3"><a href="mixed-model-protocol.html#cb46-3"></a><span class="kw">plot</span>(<span class="kw">resid</span>(M8) <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(M8), <span class="dt">xlab =</span> <span class="st">&quot;Predicted values&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Normalized residuals&quot;</span>)</span>
<span id="cb46-4"><a href="mixed-model-protocol.html#cb46-4"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="mixed-model-protocol.html#cb47-1"></a><span class="co"># Homogeneous dispersion of the residuals means that the</span></span>
<span id="cb47-2"><a href="mixed-model-protocol.html#cb47-2"></a><span class="co"># assumption is respected.</span></span></code></pre></div>
<p><strong>Yes! Homogeneous dispersion of the residuals means that the assumption is respected.</strong></p>
</div>
<div id="check-the-independence-of-the-model-residuals-with-each-covariate" class="section level3 unnumbered">
<h3>2. Check the independence of the model residuals with each covariate</h3>
<p>In order to check the independence of the model residuals with each covariate we will (1) plot residuals vs each covariate of the model and (2) plot residuals vs each covariate not included in the model.</p>
<p>Let’s start by (1) plotting the residuals vs each covariate of the model.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="mixed-model-protocol.html#cb48-1"></a><span class="co"># In order to check the independence of the model residuals</span></span>
<span id="cb48-2"><a href="mixed-model-protocol.html#cb48-2"></a><span class="co"># we need to plot residuals vs each covariate of the model</span></span>
<span id="cb48-3"><a href="mixed-model-protocol.html#cb48-3"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb48-4"><a href="mixed-model-protocol.html#cb48-4"></a></span>
<span id="cb48-5"><a href="mixed-model-protocol.html#cb48-5"></a><span class="kw">plot</span>(<span class="kw">resid</span>(M8) <span class="op">~</span><span class="st"> </span>fish.data<span class="op">$</span>Z_Length, <span class="dt">xlab =</span> <span class="st">&quot;Length&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Normalized residuals&quot;</span>)</span>
<span id="cb48-6"><a href="mixed-model-protocol.html#cb48-6"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb48-7"><a href="mixed-model-protocol.html#cb48-7"></a></span>
<span id="cb48-8"><a href="mixed-model-protocol.html#cb48-8"></a><span class="kw">boxplot</span>(<span class="kw">resid</span>(M8) <span class="op">~</span><span class="st"> </span>Fish_Species, <span class="dt">data =</span> fish.data, <span class="dt">xlab =</span> <span class="st">&quot;Species&quot;</span>, </span>
<span id="cb48-9"><a href="mixed-model-protocol.html#cb48-9"></a>    <span class="dt">ylab =</span> <span class="st">&quot;Normalized residuals&quot;</span>)</span>
<span id="cb48-10"><a href="mixed-model-protocol.html#cb48-10"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb48-11"><a href="mixed-model-protocol.html#cb48-11"></a></span>
<span id="cb48-12"><a href="mixed-model-protocol.html#cb48-12"></a><span class="kw">boxplot</span>(<span class="kw">resid</span>(M8) <span class="op">~</span><span class="st"> </span>Lake, <span class="dt">data =</span> fish.data, <span class="dt">xlab =</span> <span class="st">&quot;Lakes&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Normalized residuals&quot;</span>)</span>
<span id="cb48-13"><a href="mixed-model-protocol.html#cb48-13"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="mixed-model-protocol.html#cb49-1"></a><span class="co"># Homogeneous dispersion of the residuals around 0 means no</span></span>
<span id="cb49-2"><a href="mixed-model-protocol.html#cb49-2"></a><span class="co"># pattern of residuals depending on the variable, therefore</span></span>
<span id="cb49-3"><a href="mixed-model-protocol.html#cb49-3"></a><span class="co"># the assumption is respected!  Note: The clusters are due to</span></span>
<span id="cb49-4"><a href="mixed-model-protocol.html#cb49-4"></a><span class="co"># the data structure, where fish of only 5 size classes</span></span>
<span id="cb49-5"><a href="mixed-model-protocol.html#cb49-5"></a><span class="co"># (large, small, and three groups in between) were captured.</span></span></code></pre></div>
<p><strong>Homogeneous dispersion of the residuals around 0 means no pattern of residuals depending on the variable, therefore the assumption is respected!</strong></p>
<p><em>Note: The clusters are due to the data structure, where fish of only 5 size classes (large, small, and three groups in between) were captured.</em></p>
<p>Now, we should (2) plot residuals vs each covariate not included in the model.</p>
<p>If you observe patterns in these plots, you will know that there is variation in your dataset that could be explained by these covariates and you should consider including them in your model. <strong>However because we have included all the measured variables in our model, we can not do this step with our data.</strong></p>
</div>
<div id="check-the-normality-of-the-model-residuals" class="section level3 unnumbered">
<h3>3. Check the normality of the model residuals</h3>
<p>Now we will check the normality of the model residuals as residuals following a normal distribution indicate that the model is not biased.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="mixed-model-protocol.html#cb50-1"></a><span class="co"># Check the normality of the model residuals as residuals</span></span>
<span id="cb50-2"><a href="mixed-model-protocol.html#cb50-2"></a><span class="co"># following a normal distribution indicate that the model is</span></span>
<span id="cb50-3"><a href="mixed-model-protocol.html#cb50-3"></a><span class="co"># not biased.</span></span>
<span id="cb50-4"><a href="mixed-model-protocol.html#cb50-4"></a><span class="kw">hist</span>(<span class="kw">resid</span>(M8))</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="mixed-model-protocol.html#cb51-1"></a><span class="co"># The residuals are normal! This means our model is not</span></span>
<span id="cb51-2"><a href="mixed-model-protocol.html#cb51-2"></a><span class="co"># biased.</span></span></code></pre></div>
<p><strong>The residuals are normal! This means our model is not biased.</strong></p>
</div>
</div>
<div id="step-4.-interpretation-and-visualization" class="section level2 unnumbered">
<h2>Step 4. Interpretation and visualization</h2>
<p>Let’s take a closer look at our final model using the <code>summary()</code> function. How can we interpret this information?</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="mixed-model-protocol.html#cb52-1"></a><span class="co"># Now we are ready for interpretation and visualization Let&#39;s</span></span>
<span id="cb52-2"><a href="mixed-model-protocol.html#cb52-2"></a><span class="co"># take a closer look at our final model using the `summary()`</span></span>
<span id="cb52-3"><a href="mixed-model-protocol.html#cb52-3"></a><span class="co"># function.</span></span>
<span id="cb52-4"><a href="mixed-model-protocol.html#cb52-4"></a>(summ_M8 &lt;-<span class="st"> </span><span class="kw">summary</span>(M8))</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Z_TP ~ Z_Length + (1 + Z_Length | Fish_Species) + (1 | Lake)
##    Data: fish.data
## 
## REML criterion at convergence: 21.7
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.77187 -0.60166  0.05589  0.64239  2.27776 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev. Corr
##  Lake         (Intercept) 0.20504  0.4528       
##  Fish_Species (Intercept) 0.86715  0.9312       
##               Z_Length    0.02466  0.1570   1.00
##  Residual                 0.05039  0.2245       
## Number of obs: 180, groups:  Lake, 6; Fish_Species, 3
## 
## Fixed effects:
##               Estimate Std. Error t value
## (Intercept) -0.0009059  0.5687733  -0.002
## Z_Length     0.4222697  0.0922117   4.579
## 
## Correlation of Fixed Effects:
##          (Intr)
## Z_Length 0.929 
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see ?isSingular</code></pre>
<p><strong>Let’s go section by section and try to understand what we are looking at.</strong></p>
<ins>
Random effects:
</ins>
<ul>
<li><p><code>Groups</code>: grouping factors</p></li>
<li><p><code>Name</code>: <code>(Intercept)</code> for the intercepts or the name of the variable on which the random slope is estimated (<code>Z_length</code> in this example)</p></li>
<li><p><code>Variance</code> the variance of the estimated effect (<code>Std.Dev.</code> is the standard deviation of this estimate)</p></li>
<li><p><code>Corr</code> the correlation between the random interpet and the random slope for a given grouping factor (see <a href="https://stats.stackexchange.com/questions/320978/understanding-and-coding-random-intercept-correlation-lmer">this dicussion</a>).</p></li>
</ul>
<hr />
<ins>
Fixed effects:
</ins>
<p>This part presents the fixed effect estimates. The value of the t statistics <a href="https://en.wikipedia.org/wiki/T-statistic">(Student test)</a> is shown <strong>without the p-value</strong> (it is a decision from the package authors, see why in <a href="https://stats.stackexchange.com/questions/185360/t-value-associated-with-nlme-lme4">this discussion</a>).</p>
<p>This statistics could be used as it is. You could also calculate the 95% confidence interval (CI) with this equation:</p>
<p><span class="math display">\[ CI = Estimate \pm 1.96*Std.Error \]</span></p>
<p>If 0 is in the interval, then the parameter is not significantly different from zero at a threshold of <span class="math inline">\(\alpha\)</span> = 0.05.</p>
<hr />
<p><strong>Some useful functions</strong></p>
<ul>
<li><p><code>coef(M8)</code> and <code>ranef(M8)</code> return random effects of model M8</p></li>
<li><p><code>coef(summary(M8))</code> returns fixed effects</p></li>
<li><p><code>sigma(M8)</code> returns standard deviation of residuals</p></li>
<li><p><code>fitted(M8)</code> returns predicted values by the model</p></li>
<li><p><code>residuals(M8)</code> returns residuals</p></li>
</ul>
<div id="challenge-6" class="section level3 unnumbered">
<h3>Challenge 6</h3>
<ul>
<li><p><strong>1.</strong> What is the slope and confidence interval of the Z_Length variable in the M8 model?</p></li>
<li><p><strong>2.</strong> Is the slope of Z_Length significantly different from 0?</p></li>
</ul>
<hr />
<div id="challenge-6-solution" class="section level4 unnumbered">
<h4><strong>Challenge 6 Solution:</strong></h4>
<p><strong>1.</strong> What is the slope and confidence interval of the Z_Length variable in the M8 model?</p>
<ul>
<li><p>slope = 0.422;</p></li>
<li><p>CI upper limit = 0.4223 + 0.09*1.96 = 0.5987</p></li>
<li><p>CI lower limit = 0.4223 - 0.09*1.96 = 0.2459</p></li>
</ul>
<p><strong>2.</strong> Is the slope of Z_Length significantly different from 0?</p>
<ul>
<li>Yes, because the CI [0.2459, 0.5987] does not include 0</li>
</ul>
</div>
</div>
<div id="challenge-7" class="section level3 unnumbered">
<h3>Challenge 7</h3>
<p><strong>Is it possible to visualize graphically the different intercepts and slopes of the model to better interpret the results?</strong></p>
<p>Take 2 minutes to think about different ways to represent the results of M8.</p>
<p><em>Hint: consider the different “levels” of the model</em></p>
<hr />
<div id="challenge-7-solution" class="section level4 unnumbered">
<h4><strong>Challenge 7 Solution:</strong></h4>
<p><strong>Is it possible to visualize graphically the different intercepts and slopes of the model to better interpret the results?</strong></p>
<p>Yes! We could do this by generating:</p>
<ol style="list-style-type: lower-alpha">
<li><p>A figure with all data grouped</p></li>
<li><p>A figure by species</p></li>
<li><p>A figure by lake</p></li>
</ol>
<p>To produce these figures, we need (1) the coefficients of the full model that are in the model summary, (2) The coefficients for each level of the model, which can be obtained with the <code>coef</code> function</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="mixed-model-protocol.html#cb54-1"></a><span class="co"># Challenge 7: *Is it possible to visualize graphically the</span></span>
<span id="cb54-2"><a href="mixed-model-protocol.html#cb54-2"></a><span class="co"># different intercepts and slopes of the model to better</span></span>
<span id="cb54-3"><a href="mixed-model-protocol.html#cb54-3"></a><span class="co"># interpret the results?</span></span>
<span id="cb54-4"><a href="mixed-model-protocol.html#cb54-4"></a></span>
<span id="cb54-5"><a href="mixed-model-protocol.html#cb54-5"></a><span class="co"># Challenge 7 solution: Yes! We could do this by generating</span></span>
<span id="cb54-6"><a href="mixed-model-protocol.html#cb54-6"></a><span class="co"># the following figures.  a) A figure with all data grouped</span></span>
<span id="cb54-7"><a href="mixed-model-protocol.html#cb54-7"></a><span class="co"># b) A figure by species c) A figure by lake</span></span>
<span id="cb54-8"><a href="mixed-model-protocol.html#cb54-8"></a></span>
<span id="cb54-9"><a href="mixed-model-protocol.html#cb54-9"></a><span class="co"># To produce these figures, first we need the coefficients of</span></span>
<span id="cb54-10"><a href="mixed-model-protocol.html#cb54-10"></a><span class="co"># the full model that are in the model summary.</span></span>
<span id="cb54-11"><a href="mixed-model-protocol.html#cb54-11"></a>summ_M8<span class="op">$</span>coefficients</span></code></pre></div>
<pre><code>##                  Estimate Std. Error      t value
## (Intercept) -0.0009058974 0.56877327 -0.001592722
## Z_Length     0.4222697238 0.09221166  4.579352788</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="mixed-model-protocol.html#cb56-1"></a><span class="co"># Intercept = Intercept = 9.0589745 × 10^4 Slope = 0.4222697</span></span>
<span id="cb56-2"><a href="mixed-model-protocol.html#cb56-2"></a></span>
<span id="cb56-3"><a href="mixed-model-protocol.html#cb56-3"></a><span class="co"># We also need the coefficients for each level of the model,</span></span>
<span id="cb56-4"><a href="mixed-model-protocol.html#cb56-4"></a><span class="co"># which can be obtained with the `coef` function</span></span>
<span id="cb56-5"><a href="mixed-model-protocol.html#cb56-5"></a><span class="kw">coef</span>(M8)</span></code></pre></div>
<pre><code>## $Lake
##     (Intercept)  Z_Length
## L1 -0.085984071 0.4222697
## L2  0.002205209 0.4222697
## L3 -0.301816557 0.4222697
## L4 -0.574039728 0.4222697
## L5  0.218650140 0.4222697
## L6  0.735549622 0.4222697
## 
## $Fish_Species
##    (Intercept)  Z_Length
## S1  -1.0752985 0.2410746
## S2   0.5597871 0.5168300
## S3   0.5127938 0.5089046
## 
## attr(,&quot;class&quot;)
## [1] &quot;coef.mer&quot;</code></pre>
<p><strong>Now let’s make our figures!</strong></p>
<ol style="list-style-type: lower-alpha">
<li>Figure with all data grouped</li>
</ol>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="mixed-model-protocol.html#cb58-1"></a><span class="co"># Now let&#39;s make our figures!</span></span>
<span id="cb58-2"><a href="mixed-model-protocol.html#cb58-2"></a><span class="kw">library</span>(ggplot2)  <span class="co"># Load ggplot2 if you haven&#39;t already</span></span>
<span id="cb58-3"><a href="mixed-model-protocol.html#cb58-3"></a></span>
<span id="cb58-4"><a href="mixed-model-protocol.html#cb58-4"></a><span class="co"># a) Figure with all data grouped Create a simplified ggplot</span></span>
<span id="cb58-5"><a href="mixed-model-protocol.html#cb58-5"></a><span class="co"># theme</span></span>
<span id="cb58-6"><a href="mixed-model-protocol.html#cb58-6"></a>fig &lt;-<span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), </span>
<span id="cb58-7"><a href="mixed-model-protocol.html#cb58-7"></a>    <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb58-8"><a href="mixed-model-protocol.html#cb58-8"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text.y =</span> <span class="kw">element_text</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb58-9"><a href="mixed-model-protocol.html#cb58-9"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_blank</span>()) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.key =</span> <span class="kw">element_blank</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb58-10"><a href="mixed-model-protocol.html#cb58-10"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>))</span>
<span id="cb58-11"><a href="mixed-model-protocol.html#cb58-11"></a></span>
<span id="cb58-12"><a href="mixed-model-protocol.html#cb58-12"></a>plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Z_Length, Z_TP), <span class="dt">data =</span> fish.data)</span>
<span id="cb58-13"><a href="mixed-model-protocol.html#cb58-13"></a>Plot_AllData &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Length (mm)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Trophic position&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb58-14"><a href="mixed-model-protocol.html#cb58-14"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;All data&quot;</span>) <span class="op">+</span><span class="st"> </span>fig</span>
<span id="cb58-15"><a href="mixed-model-protocol.html#cb58-15"></a></span>
<span id="cb58-16"><a href="mixed-model-protocol.html#cb58-16"></a>Plot_AllData <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> summ_M8<span class="op">$</span>coefficients[<span class="dv">1</span>, </span>
<span id="cb58-17"><a href="mixed-model-protocol.html#cb58-17"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> summ_M8<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>])</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="mixed-model-protocol.html#cb59-1"></a><span class="co"># You could also write out the numbers like this:</span></span>
<span id="cb59-2"><a href="mixed-model-protocol.html#cb59-2"></a><span class="co"># Plot_AllData + geom_abline(intercept = -0.0009059, slope =</span></span>
<span id="cb59-3"><a href="mixed-model-protocol.html#cb59-3"></a><span class="co"># 0.4222697)</span></span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Figure by species</li>
</ol>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="mixed-model-protocol.html#cb60-1"></a><span class="co"># b) Figure by species Create a table with the coefs to</span></span>
<span id="cb60-2"><a href="mixed-model-protocol.html#cb60-2"></a><span class="co"># facilitate their manipulation</span></span>
<span id="cb60-3"><a href="mixed-model-protocol.html#cb60-3"></a>Lake.coef &lt;-<span class="st"> </span><span class="kw">coef</span>(M8)<span class="op">$</span>Lake</span>
<span id="cb60-4"><a href="mixed-model-protocol.html#cb60-4"></a><span class="kw">colnames</span>(Lake.coef) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Slope&quot;</span>)</span>
<span id="cb60-5"><a href="mixed-model-protocol.html#cb60-5"></a>Species.coef &lt;-<span class="st"> </span><span class="kw">coef</span>(M8)<span class="op">$</span>Fish_Species</span>
<span id="cb60-6"><a href="mixed-model-protocol.html#cb60-6"></a><span class="kw">colnames</span>(Species.coef) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Slope&quot;</span>)</span>
<span id="cb60-7"><a href="mixed-model-protocol.html#cb60-7"></a></span>
<span id="cb60-8"><a href="mixed-model-protocol.html#cb60-8"></a>Plot_BySpecies &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="kw">factor</span>(Fish_Species)), </span>
<span id="cb60-9"><a href="mixed-model-protocol.html#cb60-9"></a>    <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Length (mm)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Trophic position&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb60-10"><a href="mixed-model-protocol.html#cb60-10"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;By species&quot;</span>) <span class="op">+</span><span class="st"> </span>fig</span>
<span id="cb60-11"><a href="mixed-model-protocol.html#cb60-11"></a></span>
<span id="cb60-12"><a href="mixed-model-protocol.html#cb60-12"></a><span class="co"># Add regression lines for each species</span></span>
<span id="cb60-13"><a href="mixed-model-protocol.html#cb60-13"></a>Plot_BySpecies <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Species.coef[<span class="dv">1</span>, <span class="dv">1</span>], </span>
<span id="cb60-14"><a href="mixed-model-protocol.html#cb60-14"></a>    <span class="dt">slope =</span> Species.coef[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;coral2&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Species.coef[<span class="dv">2</span>, </span>
<span id="cb60-15"><a href="mixed-model-protocol.html#cb60-15"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Species.coef[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;green4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Species.coef[<span class="dv">3</span>, </span>
<span id="cb60-16"><a href="mixed-model-protocol.html#cb60-16"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Species.coef[<span class="dv">3</span>, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;blue1&quot;</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Figure by lake</li>
</ol>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="mixed-model-protocol.html#cb61-1"></a><span class="co"># c) Figure by lake</span></span>
<span id="cb61-2"><a href="mixed-model-protocol.html#cb61-2"></a>Plot_ByLake &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="kw">factor</span>(Lake)), </span>
<span id="cb61-3"><a href="mixed-model-protocol.html#cb61-3"></a>    <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Length (mm)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Trophic Position&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb61-4"><a href="mixed-model-protocol.html#cb61-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;By Lake&quot;</span>) <span class="op">+</span><span class="st"> </span>fig</span>
<span id="cb61-5"><a href="mixed-model-protocol.html#cb61-5"></a></span>
<span id="cb61-6"><a href="mixed-model-protocol.html#cb61-6"></a><span class="co"># Add in regression lines with the intercepts specific to</span></span>
<span id="cb61-7"><a href="mixed-model-protocol.html#cb61-7"></a><span class="co"># each lake</span></span>
<span id="cb61-8"><a href="mixed-model-protocol.html#cb61-8"></a>Plot_ByLake <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">1</span>, </span>
<span id="cb61-9"><a href="mixed-model-protocol.html#cb61-9"></a>    <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;coral2&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">2</span>, </span>
<span id="cb61-10"><a href="mixed-model-protocol.html#cb61-10"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;khaki4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">3</span>, </span>
<span id="cb61-11"><a href="mixed-model-protocol.html#cb61-11"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">3</span>, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;green4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">4</span>, </span>
<span id="cb61-12"><a href="mixed-model-protocol.html#cb61-12"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">4</span>, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;darkgoldenrod&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">5</span>, </span>
<span id="cb61-13"><a href="mixed-model-protocol.html#cb61-13"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">5</span>, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;royalblue1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> Lake.coef[<span class="dv">6</span>, </span>
<span id="cb61-14"><a href="mixed-model-protocol.html#cb61-14"></a>    <span class="dv">1</span>], <span class="dt">slope =</span> Lake.coef[<span class="dv">6</span>, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;magenta3&quot;</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
</div>
</div>
<div id="challenge-8" class="section level3 unnumbered">
<h3>Challenge 8</h3>
<p>Let’s test our knowledge by considering another scenario.</p>
<p>Imagine that you have inventoried species richness <strong>in 1000 quadrats</strong> that are within <strong>10 different sites</strong> which are also within <strong>10 different forests</strong>. You also <strong>measured productivity</strong> in each <strong>quadrat</strong>.</p>
<p>You want to know if productivity is a good predictor of biodiversity. <strong>What mixed model could you use for this dataset?</strong></p>
<hr />
<div id="challenge-8-solution" class="section level4 unnumbered">
<h4><strong>Challenge 8 Solution:</strong></h4>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="mixed-model-protocol.html#cb62-1"></a><span class="kw">lmer</span>(Biodiv <span class="op">~</span><span class="st"> </span>Productivity <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Forest<span class="op">/</span>Site))</span></code></pre></div>
<p>Here the random effects are nested (i.e. Sites within forest) and not crossed.</p>
<p>Why use <code>(1 | Forest / Site)</code> rather than <code>(1 | Forest) + (1 | Site)</code>?</p>
<p>See the answer <a href="https://stats.stackexchange.com/questions/228800/crossed-vs-nested-random-effects-how-do-they-differ-and-how-are-they-specified">here</a>!</p>

</div>
</div>
</div>
</div>



<li>Intro</li>
<li>Implementing
-etc</li>
</ul>
</div>
<hr>
<center> 
  <div class="footer">
      All the content of the workshop series is under a <a href="https://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="how-do-lmms-work.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="generalized-linear-mixed-models-glmms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
